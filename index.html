<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ess-a-Bagel Training Academy - Complete Edition</title>
    <style>
        :root {
            /* Authentic Ess-a-Bagel Brand Colors */
            --ess-green: #083915;
            --artisanal-green: #062B0F;
            --sage-green: #A3AB8D;
            --sophisticated-gray: #E4E3E3;
            --cream-white: #F6F6F6;
            --blushing-bagel: #FFAB7F;
            --golden-crust: #FFD687;
            --fresh-nova: #FFA490;
            --light-golden-crust: #FFE9B8;
            --light-blushing-bagel: #FEC1AB;
            --light-fresh-nova: #FFD2A9;
            
            /* System Colors */
            --success-color: #28a745;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
            --info-color: #17a2b8;
            --white: #ffffff;
            --text-dark: #2c3e50;
            --text-light: #6c757d;
            --border-color: #dee2e6;
            
            /* Effects */
            --shadow: 0 4px 20px rgba(8, 57, 21, 0.1);
            --shadow-lg: 0 8px 40px rgba(8, 57, 21, 0.15);
            --shadow-xl: 0 20px 60px rgba(8, 57, 21, 0.2);
            --border-radius: 16px;
            --border-radius-sm: 12px;
            --border-radius-xs: 8px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --font-family: 'Libre Franklin', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            --heading-font: 'Cormorant Garamond', 'EB Garamond', serif;
            
            /* Gold Accents */
            --gold: linear-gradient(135deg, #FFD687 0%, #FFA490 50%, #FFAB7F 100%);
            --gold-solid: #FFD687;
        }

        @import url('https://fonts.googleapis.com/css2?family=Libre+Franklin:wght@300;400;600;700;800&family=Cormorant+Garamond:wght@400;600;700&family=EB+Garamond:wght@400;500;600;700&display=swap');

        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: var(--font-family);
            line-height: 1.6;
            color: var(--text-dark);
            background: linear-gradient(135deg, var(--cream-white) 0%, var(--sophisticated-gray) 100%);
            min-height: 100vh;
            position: relative;
        }

        /* Winky Mascot Animations */
        .winky {
            display: inline-block;
            font-size: 2rem;
            animation: wink 4s infinite;
            cursor: pointer;
            transition: var(--transition);
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
        }

        .winky:hover {
            transform: scale(1.1) rotate(5deg);
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.2));
        }

        @keyframes wink {
            0%, 85%, 100% { content: 'üòâ'; }
            90%, 95% { content: 'üòä'; }
        }

        .winky::before {
            content: 'üòâ';
        }

        .winky.celebrate::before {
            content: 'ü•Ø';
            animation: celebrate 2s ease-in-out;
        }

        @keyframes celebrate {
            0%, 100% { transform: rotate(0deg) scale(1); }
            25% { transform: rotate(-10deg) scale(1.1); }
            75% { transform: rotate(10deg) scale(1.1); }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-8px); }
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(8, 57, 21, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(8, 57, 21, 0); }
            100% { box-shadow: 0 0 0 0 rgba(8, 57, 21, 0); }
        }

        /* Bagel Pattern Background */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 20% 80%, rgba(255, 214, 135, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 171, 127, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(163, 171, 141, 0.05) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }

        .container { 
            max-width: 1400px; 
            margin: 0 auto; 
            padding: 20px; 
            position: relative;
            z-index: 1;
        }
        
        .header {
            background: linear-gradient(135deg, var(--ess-green) 0%, var(--artisanal-green) 100%);
            color: var(--white);
            padding: 40px;
            text-align: center;
            border-radius: var(--border-radius);
            margin-bottom: 30px;
            box-shadow: var(--shadow-xl);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--gold);
            opacity: 0.1;
            pointer-events: none;
        }

        .header h1 {
            font-family: var(--heading-font);
            font-size: 3.2rem;
            font-weight: 700;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            background: var(--gold);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header .subtitle {
            font-size: 1.4rem;
            opacity: 0.9;
            font-weight: 400;
            font-style: italic;
        }

        .brand-logo {
            display: inline-block;
            font-size: 4rem;
            margin-right: 20px;
            animation: float 3s ease-in-out infinite;
            cursor: pointer;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.2));
        }

        .card {
            background: var(--white);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 35px;
            margin-bottom: 30px;
            transition: var(--transition);
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: var(--gold);
            opacity: 0;
            transition: var(--transition);
        }

        .card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-xl);
        }

        .card:hover::before {
            opacity: 1;
        }

        .login-card {
            max-width: 550px;
            margin: 0 auto;
            text-align: center;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
        }

        .form-group {
            margin-bottom: 25px;
            text-align: left;
        }

        .form-label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--ess-green);
            font-size: 16px;
        }

        .form-input {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius-sm);
            font-size: 16px;
            transition: var(--transition);
            background: var(--white);
            font-family: var(--font-family);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--ess-green);
            box-shadow: 0 0 0 3px rgba(8, 57, 21, 0.1);
            transform: translateY(-2px);
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 16px 32px;
            background: var(--ess-green);
            color: var(--white);
            text-decoration: none;
            border: none;
            border-radius: var(--border-radius-sm);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
            position: relative;
            overflow: hidden;
            font-family: var(--font-family);
            gap: 8px;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.6s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover {
            background: var(--artisanal-green);
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }

        .btn-secondary { background: var(--text-light); }
        .btn-secondary:hover { background: #5a6268; }
        .btn-success { background: var(--success-color); }
        .btn-success:hover { background: #218838; }
        .btn-warning { background: var(--warning-color); color: var(--text-dark); }
        .btn-warning:hover { background: #e0a800; }
        .btn-danger { background: var(--danger-color); }
        .btn-danger:hover { background: #c82333; }
        .btn-info { background: var(--info-color); }
        .btn-info:hover { background: #138496; }
        .btn-gold { background: var(--gold); color: var(--text-dark); font-weight: 700; }
        .btn-gold:hover { transform: translateY(-3px) scale(1.02); }

        .btn-small { padding: 10px 20px; font-size: 14px; }
        .btn-large { padding: 20px 40px; font-size: 18px; }
        .btn-full { width: 100%; margin: 10px 0; }
        .btn-pulse { animation: pulse 2s infinite; }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin: 30px 0;
        }

        .stat-card {
            background: var(--white);
            padding: 30px;
            border-radius: var(--border-radius);
            text-align: center;
            box-shadow: var(--shadow);
            border-left: 6px solid var(--ess-green);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(8, 57, 21, 0.03), transparent);
            transform: rotate(45deg);
            transition: var(--transition);
            opacity: 0;
        }

        .stat-card:hover::before {
            opacity: 1;
            animation: shimmer 2s ease-in-out;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
            border-left-color: var(--golden-crust);
        }

        .stat-number {
            font-size: 3.2rem;
            font-weight: 800;
            color: var(--ess-green);
            margin-bottom: 10px;
            font-family: var(--heading-font);
            background: var(--gold);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-label {
            color: var(--text-light);
            font-weight: 600;
            font-size: 1.1rem;
        }

        .module-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(420px, 1fr));
            gap: 30px;
            margin: 30px 0;
        }

        .module-card {
            background: var(--white);
            border-radius: var(--border-radius);
            padding: 35px;
            box-shadow: var(--shadow);
            cursor: pointer;
            transition: var(--transition);
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .module-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: var(--gold);
            transform: scaleX(0);
            transition: var(--transition);
        }

        .module-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-xl);
            border-color: var(--ess-green);
        }

        .module-card:hover::before {
            transform: scaleX(1);
        }

        .module-card.completed {
            border-color: var(--success-color);
            background: linear-gradient(135deg, #f0fff4 0%, #dcf8c6 100%);
        }

        .module-card.locked {
            opacity: 0.6;
            cursor: not-allowed;
            background: var(--sophisticated-gray);
        }

        .module-header {
            display: flex;
            align-items: center;
            margin-bottom: 25px;
        }

        .module-icon {
            font-size: 4rem;
            margin-right: 25px;
            animation: float 3s ease-in-out infinite;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.1));
        }

        .module-title {
            font-family: var(--heading-font);
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--ess-green);
            margin-bottom: 8px;
        }

        .module-description {
            color: var(--text-light);
            line-height: 1.6;
            font-size: 1.1rem;
        }

        .module-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 25px;
            padding-top: 25px;
            border-top: 1px solid var(--border-color);
        }

        .progress-bar {
            width: 100%;
            height: 14px;
            background: var(--sophisticated-gray);
            border-radius: 7px;
            overflow: hidden;
            margin: 15px 0;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: var(--gold);
            transition: width 1s ease;
            border-radius: 7px;
            position: relative;
            overflow: hidden;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: progress-shine 2s ease-in-out infinite;
        }

        @keyframes progress-shine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* Content Styling */
        .lesson-content {
            background: var(--cream-white);
            padding: 35px;
            border-radius: var(--border-radius);
            margin: 25px 0;
            border-left: 6px solid var(--ess-green);
            line-height: 1.8;
            position: relative;
        }

        .key-point {
            background: linear-gradient(135deg, #e8f5e8 0%, #d4edda 100%);
            padding: 25px;
            border-radius: var(--border-radius-sm);
            margin: 25px 0;
            border-left: 6px solid var(--success-color);
            font-weight: 600;
            position: relative;
        }

        .key-point::before {
            content: 'üéØ';
            position: absolute;
            top: -10px;
            right: 20px;
            font-size: 2rem;
            background: var(--white);
            padding: 5px;
            border-radius: 50%;
            box-shadow: var(--shadow);
        }

        .tip-box {
            background: linear-gradient(135deg, var(--light-golden-crust) 0%, var(--golden-crust) 100%);
            padding: 25px;
            border-radius: var(--border-radius-sm);
            margin: 25px 0;
            border-left: 6px solid var(--golden-crust);
            position: relative;
        }

        .tip-box::before {
            content: 'üí°';
            position: absolute;
            top: -10px;
            right: 20px;
            font-size: 2rem;
            background: var(--white);
            padding: 5px;
            border-radius: 50%;
            box-shadow: var(--shadow);
        }

        .warning-box {
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
            padding: 25px;
            border-radius: var(--border-radius-sm);
            margin: 25px 0;
            border-left: 6px solid var(--danger-color);
            position: relative;
        }

        .warning-box::before {
            content: '‚ö†Ô∏è';
            position: absolute;
            top: -10px;
            right: 20px;
            font-size: 2rem;
            background: var(--white);
            padding: 5px;
            border-radius: 50%;
            box-shadow: var(--shadow);
        }

        /* Quiz Styling */
        .quiz-container {
            background: var(--white);
            padding: 35px;
            border-radius: var(--border-radius);
            margin: 25px 0;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
        }

        .quiz-question {
            background: linear-gradient(135deg, var(--cream-white) 0%, var(--sophisticated-gray) 100%);
            padding: 30px;
            border-radius: var(--border-radius-sm);
            border-left: 6px solid var(--ess-green);
            margin-bottom: 30px;
            position: relative;
        }

        .quiz-option {
            display: block;
            width: 100%;
            padding: 20px 25px;
            margin: 15px 0;
            border: 2px solid var(--border-color);
            background: var(--white);
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            transition: var(--transition);
            text-align: left;
            position: relative;
            font-family: var(--font-family);
            font-size: 16px;
        }

        .quiz-option:hover {
            border-color: var(--ess-green);
            background: linear-gradient(135deg, var(--cream-white) 0%, #e8f5e8 100%);
            transform: translateX(10px);
            box-shadow: var(--shadow);
        }

        .quiz-option.correct {
            border-color: var(--success-color);
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
            animation: correct 0.8s ease;
        }

        .quiz-option.incorrect {
            border-color: var(--danger-color);
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
            animation: incorrect 0.8s ease;
        }

        @keyframes correct {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes incorrect {
            0%, 100% { transform: translateX(0); }
            20% { transform: translateX(-10px); }
            40% { transform: translateX(10px); }
            60% { transform: translateX(-5px); }
            80% { transform: translateX(5px); }
        }

        .quiz-tab {
            padding: 12px 24px;
            background: var(--sophisticated-gray);
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
            margin-right: 10px;
        }

        .quiz-tab.active {
            background: var(--ess-green);
            color: var(--white);
            border-color: var(--ess-green);
        }

        .quiz-tab.completed {
            background: var(--success-color);
            color: var(--white);
            border-color: var(--success-color);
        }

        .quiz-tab.failed {
            background: var(--danger-color);
            color: var(--white);
            border-color: var(--danger-color);
        }

        /* Modal Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        .modal-content {
            background: var(--white);
            padding: 45px;
            border-radius: var(--border-radius);
            text-align: center;
            max-width: 700px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-xl);
            animation: modalIn 0.4s ease;
            position: relative;
        }

        .modal-content-large {
            max-width: 1200px;
            width: 95%;
            max-height: 95vh;
            text-align: left;
        }

        @keyframes modalIn {
            from { 
                transform: scale(0.7) translateY(-50px); 
                opacity: 0; 
            }
            to { 
                transform: scale(1) translateY(0); 
                opacity: 1; 
            }
        }

        /* Admin Panel Styles */
        .admin-nav {
            background: var(--white);
            border-radius: var(--border-radius);
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            align-items: center;
            border: 1px solid var(--border-color);
        }

        .admin-nav .nav-item {
            padding: 15px 25px;
            background: var(--sophisticated-gray);
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .admin-nav .nav-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(8, 57, 21, 0.1), transparent);
            transition: left 0.5s;
        }

        .admin-nav .nav-item:hover::before {
            left: 100%;
        }

        .admin-nav .nav-item:hover {
            background: var(--ess-green);
            color: var(--white);
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .admin-nav .nav-item.active {
            background: var(--ess-green);
            color: var(--white);
            border-color: var(--artisanal-green);
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .editor-panel {
            background: var(--white);
            border-radius: var(--border-radius);
            padding: 35px;
            margin-bottom: 25px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
        }

        .editor-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 30px;
            margin-top: 25px;
        }

        .editor-section {
            background: var(--cream-white);
            padding: 30px;
            border-radius: var(--border-radius-sm);
            border: 1px solid var(--border-color);
            transition: var(--transition);
        }

        .editor-section:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        /* Notification System */
        .notification {
            position: fixed;
            top: 30px;
            right: 30px;
            padding: 20px 30px;
            border-radius: var(--border-radius-sm);
            color: var(--white);
            font-weight: 600;
            z-index: 2000;
            max-width: 400px;
            transform: translateX(150%);
            transition: var(--transition);
            box-shadow: var(--shadow-lg);
            backdrop-filter: blur(10px);
        }

        .notification.success { 
            background: linear-gradient(135deg, var(--success-color), #20c997); 
        }
        .notification.warning { 
            background: linear-gradient(135deg, var(--warning-color), #fd7e14); 
            color: var(--text-dark); 
        }
        .notification.error { 
            background: linear-gradient(135deg, var(--danger-color), #e74c3c); 
        }
        .notification.info { 
            background: linear-gradient(135deg, var(--info-color), #3498db); 
        }

        .notification.show {
            transform: translateX(0);
        }

        .hidden { 
            display: none !important; 
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container { padding: 15px; }
            .header { padding: 30px 20px; }
            .header h1 { font-size: 2.5rem; }
            .card { padding: 25px; }
            .module-grid { grid-template-columns: 1fr; gap: 25px; }
            .stats-grid { grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); }
            .btn { width: 100%; margin: 5px 0; }
            .modal-content { padding: 30px; margin: 20px; }
            .editor-grid { grid-template-columns: 1fr; gap: 20px; }
            .admin-nav { flex-direction: column; align-items: stretch; }
            .admin-nav .nav-item { text-align: center; }
            .brand-logo { font-size: 3rem; }
            .module-icon { font-size: 3rem; }
        }

        /* Winky expressions for different states */
        .winky.happy::before { content: 'üòä'; }
        .winky.excited::before { content: 'ü§©'; }
        .winky.proud::before { content: 'üòé'; }
        .winky.thinking::before { content: 'ü§î'; }
        .winky.celebrating::before { content: 'ü•≥'; }

        /* Gold texture elements */
        .gold-accent {
            background: var(--gold);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 700;
        }

        /* Content formatting for training materials */
        .chapter-content h3 {
            font-family: var(--heading-font);
            color: var(--ess-green);
            margin: 20px 0 15px 0;
            font-size: 1.5rem;
        }

        .chapter-content ul, .chapter-content ol {
            margin: 15px 0;
            padding-left: 25px;
        }

        .chapter-content li {
            margin: 8px 0;
            line-height: 1.6;
        }

        .employee-card {
            background: var(--cream-white);
            padding: 25px;
            margin: 15px 0;
            border-radius: var(--border-radius);
            border-left: 4px solid var(--ess-green);
            transition: var(--transition);
        }

        .employee-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--sophisticated-gray);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--ess-green);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--artisanal-green);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Employee Login Screen -->
        <div id="loginScreen">
            <div class="header">
                <span class="brand-logo winky" onclick="logoClickCounter()"></span>
                <h1 id="companyTitle">Ess-a-Bagel Training Academy</h1>
                <p class="subtitle" id="companySubtitle">Master the Art of Authentic New York Bagels</p>
                <div style="margin-top: 20px; display: flex; align-items: center; justify-content: center; gap: 10px;">
                    <span class="winky"></span>
                    <span style="font-size: 1.2rem; opacity: 0.9;">"To bestow the world with the finest New York-style bagels made with love"</span>
                    <span class="winky"></span>
                </div>
            </div>
            
            <div class="card login-card">
                <div style="display: flex; align-items: center; justify-content: center; margin-bottom: 30px;">
                    <span class="winky excited" style="font-size: 4rem; margin-right: 20px;"></span>
                    <div>
                        <h2 style="color: var(--ess-green); font-size: 2.5rem; font-family: var(--heading-font);">Welcome to Our Team!</h2>
                        <p style="color: var(--text-light); margin-top: 10px; font-size: 1.1rem;">Your journey to bagel mastery begins here</p>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">üë§ Employee ID</label>
                    <input type="text" id="empId" class="form-input" placeholder="Enter your unique ID (e.g., EMP001)" />
                </div>
                
                <div class="form-group">
                    <label class="form-label">üìù Full Name</label>
                    <input type="text" id="empName" class="form-input" placeholder="Enter your full name" />
                </div>
                
                <div class="form-group">
                    <label class="form-label">üè¢ Department</label>
                    <select id="empDept" class="form-input">
                        <option value="">Select Your Department</option>
                        <option value="Cashier/Counter Service">Cashier/Counter Service</option>
                        <option value="Kitchen & Food Prep">Kitchen & Food Prep</option>
                        <option value="Management">Management</option>
                        <option value="Bakery Production">Bakery Production</option>
                        <option value="Catering">Catering</option>
                        <option value="Maintenance">Maintenance</option>
                    </select>
                </div>
                
                <button class="btn btn-gold btn-large btn-full btn-pulse" onclick="startTraining()">
                    <span class="winky"></span>
                    üöÄ Begin Your Training Adventure
                </button>
                
                <div style="margin-top: 20px; text-align: center;">
                    <span class="winky thinking"></span>
                    <small style="color: var(--text-light); margin-left: 10px;">
                        Psst... Triple-click Winky for admin access!
                    </small>
                </div>
            </div>
        </div>

        <!-- Training Interface -->
        <div id="trainingInterface" class="hidden">
            <div class="header">
                <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap;">
                    <div style="display: flex; align-items: center;">
                        <span class="brand-logo winky" onclick="logoClickCounter()"></span>
                        <div>
                            <span style="font-family: var(--heading-font); font-size: 2.5rem; font-weight: 800;">Training Dashboard</span>
                            <div style="margin-top: 10px;">
                                <span style="opacity: 0.9;">Welcome back, </span>
                                <span id="currentEmployee" style="font-weight: 700; color: var(--golden-crust);">Team Member</span>
                                <span style="opacity: 0.7; display: block; font-size: 16px;" id="employeeDept">Department</span>
                            </div>
                        </div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <span class="winky proud" style="font-size: 2rem;"></span>
                        <button class="btn btn-secondary" onclick="logout()">üö™ Logout</button>
                    </div>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalPoints">0</div>
                    <div class="stat-label">üèÜ Total Points</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="chaptersCompleted">0</div>
                    <div class="stat-label">üìö Chapters Complete</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="overallProgress">0%</div>
                    <div class="stat-label">üìä Overall Progress</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="adaptiveScore">100%</div>
                    <div class="stat-label">üéØ Mastery Level</div>
                </div>
            </div>

            <!-- Adaptive Learning Dashboard -->
            <div id="adaptiveDashboard" class="card hidden" style="background: linear-gradient(135deg, var(--light-golden-crust) 0%, var(--golden-crust) 100%); border-left: 6px solid var(--golden-crust);">
                <div style="display: flex; align-items: center; margin-bottom: 20px;">
                    <span class="winky thinking" style="font-size: 3rem; margin-right: 15px;"></span>
                    <h3 style="color: var(--ess-green); font-family: var(--heading-font);">üéØ Personalized Learning Path</h3>
                </div>
                <div id="weaknessAreas"></div>
                <div id="strengthAreas"></div>
                <button class="btn btn-warning" onclick="startAdaptiveReview()">üìö Review Weak Areas</button>
            </div>

            <div id="dashboard">
                <div style="display: flex; align-items: center; justify-content: center; margin-bottom: 30px;">
                    <span class="winky excited" style="font-size: 3rem; margin-right: 20px;"></span>
                    <h2 style="color: var(--ess-green); font-size: 3rem; font-weight: 800; font-family: var(--heading-font);">üéì Your Learning Modules</h2>
                </div>
                <div class="module-grid" id="modulesDisplay"></div>
            </div>

            <!-- Lesson View -->
            <div id="lessonView" class="hidden">
                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; flex-wrap: wrap; gap: 15px;">
                        <button class="btn" onclick="backToDashboard()">‚Üê Back to Modules</button>
                        <div style="text-align: center; display: flex; align-items: center;">
                            <span class="winky" style="font-size: 2rem; margin-right: 15px;"></span>
                            <div>
                                <div style="font-size: 20px; font-weight: 700; color: var(--ess-green);" id="moduleProgress">Module Progress</div>
                                <div style="color: var(--text-light);">Chapter <span id="chapterNum">1</span> of <span id="totalChapters">5</span></div>
                            </div>
                        </div>
                        <div style="text-align: right;">
                            <span class="winky happy"></span>
                        </div>
                    </div>
                    
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    
                    <div id="lessonContent" class="lesson-content">
                        <h2 id="lessonTitle" style="color: var(--ess-green); font-size: 2.5rem; margin-bottom: 25px; display: flex; align-items: center; font-family: var(--heading-font);">
                            <span class="winky" style="margin-right: 15px;"></span>
                            Chapter Title
                        </h2>
                        <div id="lessonText" class="chapter-content">Lesson content will appear here...</div>
                    </div>
                    
                    <!-- Multi-Quiz System -->
                    <div id="quizSection" class="hidden">
                        <div class="quiz-container">
                            <div style="display: flex; align-items: center; margin-bottom: 30px;">
                                <span class="winky thinking" style="font-size: 3rem; margin-right: 20px;"></span>
                                <h3 style="color: var(--ess-green); font-size: 28px; font-family: var(--heading-font);">üìù Chapter Assessment</h3>
                            </div>
                            
                            <div style="display: flex; gap: 15px; margin: 20px 0; flex-wrap: wrap;" id="quizSelector">
                                <div class="quiz-tab active" onclick="selectQuiz(0)">Quiz 1</div>
                                <div class="quiz-tab" onclick="selectQuiz(1)">Quiz 2</div>
                                <div class="quiz-tab" onclick="selectQuiz(2)">Quiz 3</div>
                            </div>
                            
                            <div class="quiz-question">
                                <h4 id="questionText" style="margin: 0; font-size: 22px; color: var(--ess-green);">Question will appear here</h4>
                            </div>
                            <div id="optionsContainer"></div>
                            
                            <div style="margin-top: 25px; text-align: center;">
                                <div id="quizProgress" style="color: var(--text-light); margin-bottom: 20px; font-size: 18px;">Quiz 1 of 3</div>
                                <button class="btn" id="nextQuizBtn" onclick="nextQuiz()" style="display: none;">Next Quiz ‚Üí</button>
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 30px; gap: 15px; flex-wrap: wrap;">
                        <button class="btn btn-large" id="takeQuizBtn" onclick="startQuizSequence()">üìù Take Assessment</button>
                        <button class="btn btn-large hidden" id="nextChapterBtn" onclick="nextChapter()">Next Chapter ‚Üí</button>
                        <span class="winky excited"></span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Admin Dashboard -->
        <div id="managerDashboard" class="hidden">
            <div class="header">
                <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap;">
                    <div style="display: flex; align-items: center;">
                        <span style="font-size: 3rem; margin-right: 20px;">üìä</span>
                        <div>
                            <span style="font-size: 2.8rem; font-weight: 800; font-family: var(--heading-font);">Admin Control Center</span>
                            <div style="opacity: 0.8; margin-top: 5px; font-size: 18px;">Complete Management & Training System</div>
                        </div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <span class="winky proud" style="font-size: 2.5rem;"></span>
                        <button class="btn btn-success" onclick="exportAllData()">üì• Export Data</button>
                        <button class="btn btn-secondary" onclick="logout()">‚Üê Back to Login</button>
                    </div>
                </div>
            </div>

            <!-- Admin Navigation -->
            <div class="admin-nav">
                <div class="nav-item active" onclick="showAdminTab('dashboard')">üìä Dashboard</div>
                <div class="nav-item" onclick="showAdminTab('modules')">üìö Content Editor</div>
                <div class="nav-item" onclick="showAdminTab('design')">üé® Design Studio</div>
                <div class="nav-item" onclick="showAdminTab('templates')">üìã Templates</div>
                <div class="nav-item" onclick="showAdminTab('backup')">üíæ Backup/Import</div>
                <div class="nav-item" onclick="showAdminTab('settings')">‚öôÔ∏è Settings</div>
                <div class="nav-item" onclick="showAdminTab('preview')">üëÅÔ∏è Live Preview</div>
                <div class="nav-item" onclick="showAdminTab('analytics')">üìà Analytics</div>
            </div>

            <!-- Tab Content -->
            <div class="tab-content">
                <!-- Dashboard Tab -->
                <div id="dashboardTab" class="active">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number" id="totalEmployees">0</div>
                            <div class="stat-label">üë• Total Employees</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="completedEmployees">0</div>
                            <div class="stat-label">‚úÖ Training Complete</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="avgScore">0%</div>
                            <div class="stat-label">üìä Average Score</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="totalHours">0</div>
                            <div class="stat-label">‚è∞ Training Hours</div>
                        </div>
                    </div>

                    <div class="card">
                        <div style="display: flex; align-items: center; margin-bottom: 30px;">
                            <span class="winky" style="font-size: 3rem; margin-right: 20px;"></span>
                            <h2 style="color: var(--ess-green); font-family: var(--heading-font);">Employee Progress Overview</h2>
                        </div>
                        <div style="margin-bottom: 25px; display: flex; gap: 15px; flex-wrap: wrap; align-items: center;">
                            <input type="text" id="searchEmployee" class="form-input" placeholder="üîç Search employees..." onkeyup="filterEmployees()" style="max-width: 300px;">
                            <button class="btn" onclick="refreshData()">üîÑ Refresh</button>
                            <button class="btn btn-warning" onclick="clearAllData()">üóëÔ∏è Clear Data</button>
                            <span class="winky thinking"></span>
                        </div>
                        <div id="employeesList"></div>
                    </div>
                    
                    <div class="card">
                        <div class="sharing-section" style="background: linear-gradient(135deg, var(--cream-white) 0%, #e9ecef 100%); padding: 35px; border-radius: var(--border-radius); text-align: center; border: 1px solid var(--border-color);">
                            <div style="display: flex; align-items: center; justify-content: center; margin-bottom: 30px;">
                                <span class="winky celebrating" style="font-size: 3rem; margin-right: 20px;"></span>
                                <h3 style="color: var(--ess-green); font-family: var(--heading-font); font-size: 2.2rem;">üì§ Share Training System</h3>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 25px; margin-bottom: 35px;">
                                <div class="share-card" style="background: var(--white); padding: 25px; border-radius: var(--border-radius-sm); border: 1px solid var(--border-color); transition: var(--transition);">
                                    <div style="font-size: 3rem; margin-bottom: 15px;">üìß</div>
                                    <h4 style="color: var(--ess-green); margin-bottom: 15px;">Email Invitations</h4>
                                    <p style="color: var(--text-light); margin-bottom: 20px;">Send personalized training invitations to employees</p>
                                    <button class="btn btn-info btn-small" onclick="showEmailInvite()">Send Invites</button>
                                </div>
                                
                                <div class="share-card" style="background: var(--white); padding: 25px; border-radius: var(--border-radius-sm); border: 1px solid var(--border-color); transition: var(--transition);">
                                    <div style="font-size: 3rem; margin-bottom: 15px;">üì±</div>
                                    <h4 style="color: var(--ess-green); margin-bottom: 15px;">QR Code Access</h4>
                                    <p style="color: var(--text-light); margin-bottom: 20px;">Generate QR codes for easy mobile access</p>
                                    <button class="btn btn-warning btn-small" onclick="generateQR()">Generate QR</button>
                                </div>
                                
                                <div class="share-card" style="background: var(--white); padding: 25px; border-radius: var(--border-radius-sm); border: 1px solid var(--border-color); transition: var(--transition);">
                                    <div style="font-size: 3rem; margin-bottom: 15px;">üîó</div>
                                    <h4 style="color: var(--ess-green); margin-bottom: 15px;">Direct Link</h4>
                                    <p style="color: var(--text-light); margin-bottom: 20px;">Copy shareable link for instant access</p>
                                    <button class="btn btn-success btn-small" onclick="copyTrainingURL()">Copy Link</button>
                                </div>
                                
                                <div class="share-card" style="background: var(--white); padding: 25px; border-radius: var(--border-radius-sm); border: 1px solid var(--border-color); transition: var(--transition);">
                                    <div style="font-size: 3rem; margin-bottom: 15px;">üíæ</div>
                                    <h4 style="color: var(--ess-green); margin-bottom: 15px;">Download Package</h4>
                                    <p style="color: var(--text-light); margin-bottom: 20px;">Download complete training system</p>
                                    <button class="btn btn-secondary btn-small" onclick="downloadSystem()">Download</button>
                                </div>
                            </div>
                            
                            <div style="background: var(--white); padding: 25px; border-radius: var(--border-radius-sm); margin-bottom: 25px; border: 1px solid var(--border-color);">
                                <h4 style="color: var(--ess-green); margin-bottom: 15px;">üìç Current Training URL:</h4>
                                <div style="background: var(--sophisticated-gray); padding: 15px; border-radius: var(--border-radius-xs); font-family: monospace; word-break: break-all; font-size: 14px; border: 1px solid var(--border-color); margin-bottom: 15px;" id="currentURL">Loading URL...</div>
                                <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                                    <button class="btn btn-small" onclick="copyCurrentURL()">üìã Copy</button>
                                    <button class="btn btn-small btn-info" onclick="previewTraining()">üëÅÔ∏è Preview</button>
                                    <button class="btn btn-small btn-warning" onclick="testEmail()">üìß Test Email</button>
                                </div>
                            </div>
                            
                            <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                                <button class="btn btn-gold btn-large" onclick="showBulkInvite()">üì¨ Bulk Email Invite</button>
                                <button class="btn btn-info btn-large" onclick="showTrainingReport()">üìä Share Report</button>
                                <button class="btn btn-success btn-large" onclick="showIntegrations()">üîó Integrations</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Content Editor Tab -->
                <div id="modulesTab">
                    <div class="editor-panel">
                        <div style="display: flex; align-items: center; margin-bottom: 30px;">
                            <span class="winky excited" style="font-size: 3rem; margin-right: 20px;"></span>
                            <h2 style="color: var(--ess-green); font-family: var(--heading-font);">üìö Training Content Management</h2>
                        </div>
                        
                        <div style="margin-bottom: 30px; display: flex; gap: 15px; flex-wrap: wrap;">
                            <button class="btn btn-success" onclick="addNewModule()">‚ûï Add Module</button>
                            <button class="btn btn-info" onclick="reorderModules()">üîÑ Reorder</button>
                            <button class="btn btn-warning" onclick="exportContent()">üì§ Export</button>
                            <button class="btn btn-secondary" onclick="importContent()">üì• Import</button>
                            <span class="winky celebrating"></span>
                        </div>

                        <div id="modulesList"></div>
                    </div>
                </div>

                <!-- Design Studio Tab -->
                <div id="designTab">
                    <div class="editor-panel">
                        <div style="display: flex; align-items: center; margin-bottom: 30px;">
                            <span class="winky excited" style="font-size: 3rem; margin-right: 20px;"></span>
                            <h2 style="color: var(--ess-green); font-family: var(--heading-font);">üé® Ess-a-Bagel Design Studio</h2>
                        </div>
                        
                        <div class="editor-grid">
                            <div class="editor-section">
                                <h3 style="display: flex; align-items: center; margin-bottom: 20px; color: var(--ess-green);">
                                    üé® Brand Color Palette
                                    <span class="winky" style="margin-left: 10px;"></span>
                                </h3>
                                <div class="form-group">
                                    <label class="form-label">Ess-a-Green (Primary)</label>
                                    <input type="color" id="primaryColor" value="#083915" onchange="updateColors()" style="width: 80px; height: 50px; border: none; border-radius: 8px; cursor: pointer;">
                                    <small style="color: var(--text-light); display: block; margin-top: 5px;">Classic medium green - embodying tradition</small>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Artisanal Green (Dark)</label>
                                    <input type="color" id="secondaryColor" value="#062B0F" onchange="updateColors()" style="width: 80px; height: 50px; border: none; border-radius: 8px; cursor: pointer;">
                                    <small style="color: var(--text-light); display: block; margin-top: 5px;">Deep-rooted heritage and mastery</small>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Golden Crust (Accent)</label>
                                    <input type="color" id="accentColor" value="#FFD687" onchange="updateColors()" style="width: 80px; height: 50px; border: none; border-radius: 8px; cursor: pointer;">
                                    <small style="color: var(--text-light); display: block; margin-top: 5px;">Symbolizing perfection and satisfaction</small>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Background Style</label>
                                    <select id="backgroundStyle" class="form-input" onchange="updateBackground()">
                                        <option value="gradient">Gradient (Brand Standard)</option>
                                        <option value="solid">Solid Color</option>
                                        <option value="pattern">Bagel Pattern</option>
                                    </select>
                                </div>
                            </div>

                            <div class="editor-section">
                                <h3 style="color: var(--ess-green);">üìù Typography & Branding</h3>
                                <div class="form-group">
                                    <label class="form-label">Font Family</label>
                                    <select id="fontFamily" class="form-input" onchange="updateFont()">
                                        <option value="libre">Libre Franklin (Brand)</option>
                                        <option value="cormorant">Cormorant Garamond</option>
                                        <option value="eb">EB Garamond</option>
                                        <option value="system">System Default</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Company Title</label>
                                    <input type="text" id="companyTitleEdit" class="form-input" value="Ess-a-Bagel Training Academy" onchange="updateCompanyInfo()">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Company Subtitle</label>
                                    <input type="text" id="companySubtitleEdit" class="form-input" value="Master the Art of Authentic New York Bagels" onchange="updateCompanyInfo()">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">
                                        <input type="checkbox" id="goldAccents" checked onchange="updateGoldAccents()">
                                        Enable Gold Accents (Brand Feature)
                                    </label>
                                </div>
                            </div>

                            <div class="editor-section">
                                <h3 style="color: var(--ess-green);">üéØ Layout & Effects</h3>
                                <div class="form-group">
                                    <label class="form-label">Border Radius</label>
                                    <input type="range" id="borderRadius" min="0" max="25" value="16" onchange="updateBorderRadius()">
                                    <span id="borderRadiusValue">16px</span>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Card Shadow</label>
                                    <select id="shadowStyle" class="form-input" onchange="updateShadow()">
                                        <option value="normal">Normal (Brand)</option>
                                        <option value="light">Light</option>
                                        <option value="heavy">Heavy</option>
                                        <option value="none">None</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Animation Speed</label>
                                    <select id="transitionSpeed" class="form-input" onchange="updateTransitions()">
                                        <option value="slow">Slow (0.5s)</option>
                                        <option value="normal" selected>Normal (0.3s)</option>
                                        <option value="fast">Fast (0.2s)</option>
                                        <option value="instant">None</option>
                                    </select>
                                </div>
                            </div>

                            <div class="editor-section">
                                <h3 style="color: var(--ess-green);">ü•Ø Winky Mascot Settings</h3>
                                <div class="form-group">
                                    <label class="form-label">
                                        <input type="checkbox" id="winkyAnimations" checked onchange="updateWinkyAnimations()">
                                        Enable Winky Animations
                                    </label>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Winky Frequency</label>
                                    <select id="winkyFrequency" class="form-input" onchange="updateWinkyFrequency()">
                                        <option value="high">High (Playful)</option>
                                        <option value="normal" selected>Normal (Brand)</option>
                                        <option value="low">Low (Professional)</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">
                                        <input type="checkbox" id="winkyExpression" checked onchange="updateWinkyExpressions()">
                                        Dynamic Expressions
                                    </label>
                                    <small style="color: var(--text-light); display: block; margin-top: 5px;">Happy, excited, proud, thinking, celebrating</small>
                                </div>
                            </div>
                        </div>

                        <div style="margin-top: 30px; text-align: center;">
                            <button class="btn btn-gold btn-large" onclick="saveDesign()">üíæ Save Brand Design</button>
                            <button class="btn btn-secondary" onclick="resetDesign()">üîÑ Reset to Brand Standard</button>
                            <button class="btn btn-info" onclick="previewDesign()">üëÅÔ∏è Preview Changes</button>
                            <span class="winky celebrating" style="font-size: 2rem; margin-left: 15px;"></span>
                        </div>
                    </div>
                </div>

                <!-- Other tabs remain the same but with proper styling... -->
                <div id="templatesTab">
                    <div class="editor-panel">
                        <div style="display: flex; align-items: center; margin-bottom: 30px;">
                            <span class="winky" style="font-size: 3rem; margin-right: 20px;"></span>
                            <h2 style="color: var(--ess-green); font-family: var(--heading-font);">üìã Training Templates</h2>
                        </div>
                        
                        <div class="editor-grid">
                            <div class="template-card" onclick="loadTemplate('essabagel')" style="background: var(--white); border: 1px solid var(--border-color); border-radius: var(--border-radius-sm); padding: 20px; margin: 15px; cursor: pointer; transition: var(--transition); text-align: center;">
                                <h3>ü•Ø Ess-a-Bagel Complete</h3>
                                <p>Full Ess-a-Bagel training with authentic content, Winky mascot, and brand styling.</p>
                            </div>
                            <div class="template-card" onclick="loadTemplate('restaurant')" style="background: var(--white); border: 1px solid var(--border-color); border-radius: var(--border-radius-sm); padding: 20px; margin: 15px; cursor: pointer; transition: var(--transition); text-align: center;">
                                <h3>üçΩÔ∏è Restaurant Training</h3>
                                <p>Complete restaurant service training template with food safety, customer service, and POS systems.</p>
                            </div>
                            <div class="template-card" onclick="loadTemplate('retail')" style="background: var(--white); border: 1px solid var(--border-color); border-radius: var(--border-radius-sm); padding: 20px; margin: 15px; cursor: pointer; transition: var(--transition); text-align: center;">
                                <h3>üõçÔ∏è Retail Training</h3>
                                <p>Comprehensive retail training covering sales, inventory, customer relations, and store operations.</p>
                            </div>
                            <div class="template-card" onclick="loadTemplate('blank')" style="background: var(--white); border: 1px solid var(--border-color); border-radius: var(--border-radius-sm); padding: 20px; margin: 15px; cursor: pointer; transition: var(--transition); text-align: center;">
                                <h3>üìÑ Blank Template</h3>
                                <p>Start from scratch with a clean template for custom training content.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Add other tabs here with similar styling -->
                <div id="backupTab">
                    <div class="editor-panel">
                        <h2 style="color: var(--ess-green); font-family: var(--heading-font);">üíæ Backup & Import System</h2>
                        <!-- Backup content -->
                    </div>
                </div>

                <div id="settingsTab">
                    <div class="editor-panel">
                        <h2 style="color: var(--ess-green); font-family: var(--heading-font);">‚öôÔ∏è System Settings</h2>
                        <!-- Settings content -->
                    </div>
                </div>

                <div id="previewTab">
                    <div class="editor-panel">
                        <h2 style="color: var(--ess-green); font-family: var(--heading-font);">üëÅÔ∏è Live Preview</h2>
                        <!-- Preview content -->
                    </div>
                </div>

                <div id="analyticsTab">
                    <div class="editor-panel">
                        <h2 style="color: var(--ess-green); font-family: var(--heading-font);">üìà Training Analytics</h2>
                        <!-- Analytics content -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Modals and other content sections remain the same but with proper styling -->
        
        <!-- Success Modal -->
        <div id="modal" class="modal hidden">
            <div class="modal-content">
                <div style="font-size: 80px; margin-bottom: 25px;" id="modalEmoji">üéâ</div>
                <h2 style="color: var(--ess-green); margin-bottom: 20px; font-family: var(--heading-font);" id="modalTitle">Assessment Complete!</h2>
                <p id="modalMessage" style="font-size: 18px; margin-bottom: 25px;">Great work!</p>
                <div style="background: var(--cream-white); padding: 25px; border-radius: var(--border-radius-sm); margin: 25px 0;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 12px;">
                        <span>Points Earned:</span>
                        <span style="color: var(--success-color); font-weight: bold;" id="earnedPoints">+0</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 12px;">
                        <span>Quiz Score:</span>
                        <span style="color: var(--golden-crust); font-weight: bold;" id="quizScore">0%</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span>Mastery Level:</span>
                        <span style="color: var(--ess-green); font-weight: bold;" id="masteryLevel">Expert</span>
                    </div>
                </div>
                <button class="btn btn-gold" onclick="closeModal()">
                    <span class="winky celebrating"></span>
                    Continue Learning üöÄ
                </button>
            </div>
        </div>

        <!-- Module Editor Modal -->
        <div id="moduleEditorModal" class="modal hidden">
            <div class="modal-content modal-content-large">
                <h2 style="color: var(--ess-green); margin-bottom: 25px; font-family: var(--heading-font);" id="moduleEditorTitle">üìö Edit Module</h2>
                
                <div class="form-group">
                    <label class="form-label">Module Title</label>
                    <input type="text" id="moduleTitle" class="form-input" placeholder="Enter module title">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Module Icon (Emoji)</label>
                    <input type="text" id="moduleIcon" class="form-input" placeholder="üéì" maxlength="2">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Module Description</label>
                    <textarea id="moduleDescription" class="form-input" rows="3" placeholder="Enter module description"></textarea>
                </div>

                <h3 style="color: var(--ess-green); margin-top: 30px; font-family: var(--heading-font);">üìñ Chapters</h3>
                <div style="margin-bottom: 20px;">
                    <button class="btn btn-success" onclick="addNewChapter()">‚ûï Add Chapter</button>
                </div>
                
                <div id="chaptersList"></div>

                <div style="margin-top: 30px; text-align: center;">
                    <button class="btn btn-gold" onclick="saveModule()">üíæ Save Module</button>
                    <button class="btn btn-secondary" onclick="closeModuleEditor()">‚ùå Cancel</button>
                    <button class="btn btn-danger" onclick="deleteModule()" id="deleteModuleBtn" style="display: none;">üóëÔ∏è Delete Module</button>
                </div>
            </div>
        </div>

        <!-- Chapter Editor Modal -->
        <div id="chapterEditorModal" class="modal hidden">
            <div class="modal-content modal-content-large">
                <h2 style="color: var(--ess-green); margin-bottom: 25px; font-family: var(--heading-font);" id="chapterEditorTitle">üìñ Edit Chapter</h2>
                
                <div class="form-group">
                    <label class="form-label">Chapter Title</label>
                    <input type="text" id="chapterTitle" class="form-input" placeholder="Enter chapter title">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Chapter Content</label>
                    <div style="background: var(--sophisticated-gray); padding: 15px; border-radius: var(--border-radius-sm); margin-bottom: 15px; display: flex; gap: 10px; flex-wrap: wrap; align-items: center;">
                        <button type="button" onclick="formatText('bold')" style="padding: 5px 10px; margin: 2px; border: 1px solid var(--border-color); background: var(--white); border-radius: 4px; cursor: pointer; font-size: 12px;"><strong>B</strong></button>
                        <button type="button" onclick="formatText('italic')" style="padding: 5px 10px; margin: 2px; border: 1px solid var(--border-color); background: var(--white); border-radius: 4px; cursor: pointer; font-size: 12px;"><em>I</em></button>
                        <button type="button" onclick="insertKeyPoint()" style="padding: 5px 10px; margin: 2px; border: 1px solid var(--border-color); background: var(--white); border-radius: 4px; cursor: pointer; font-size: 12px;">üéØ Key Point</button>
                        <button type="button" onclick="insertTipBox()" style="padding: 5px 10px; margin: 2px; border: 1px solid var(--border-color); background: var(--white); border-radius: 4px; cursor: pointer; font-size: 12px;">üí° Tip</button>
                        <button type="button" onclick="insertWarning()" style="padding: 5px 10px; margin: 2px; border: 1px solid var(--border-color); background: var(--white); border-radius: 4px; cursor: pointer; font-size: 12px;">‚ö†Ô∏è Warning</button>
                    </div>
                    <textarea id="chapterContent" style="min-height: 350px; border: 2px solid var(--border-color); border-radius: var(--border-radius-sm); padding: 20px; font-family: var(--font-family); resize: vertical; transition: var(--transition); font-size: 16px; line-height: 1.6; width: 100%;" placeholder="Enter chapter content with HTML formatting"></textarea>
                </div>

                <h3 style="color: var(--ess-green); margin-top: 30px; font-family: var(--heading-font);">‚ùì Quizzes</h3>
                <div style="margin-bottom: 20px;">
                    <button class="btn btn-success" onclick="addNewQuiz()">‚ûï Add Quiz</button>
                </div>
                
                <div id="quizzesList"></div>

                <div style="margin-top: 30px; text-align: center;">
                    <button class="btn btn-gold" onclick="saveChapter()">üíæ Save Chapter</button>
                    <button class="btn btn-secondary" onclick="closeChapterEditor()">‚ùå Cancel</button>
                    <button class="btn btn-danger" onclick="deleteChapter()" id="deleteChapterBtn" style="display: none;">üóëÔ∏è Delete Chapter</button>
                </div>
            </div>
        </div>

        <!-- Password Modal -->
        <div id="passwordModal" class="modal hidden">
            <div class="modal-content">
                <div style="display: flex; align-items: center; justify-content: center; margin-bottom: 20px;">
                    <span class="winky thinking" style="font-size: 4rem; margin-right: 15px;"></span>
                    <h2 style="color: var(--ess-green); font-family: var(--heading-font);">üîê Manager Access</h2>
                </div>
                <p style="color: var(--text-light); margin-bottom: 20px;">Enter manager password to access admin dashboard</p>
                <input type="password" id="managerPassword" class="form-input" placeholder="Enter Password" onkeypress="checkPasswordEnter(event)" style="text-align: center; font-family: monospace; font-size: 18px;" />
                <div style="margin-top: 20px; display: flex; gap: 15px; justify-content: center;">
                    <button class="btn" onclick="verifyManagerPassword()">üîì Access Dashboard</button>
                    <button class="btn btn-secondary" onclick="closePasswordModal()">‚ùå Cancel</button>
                </div>
            </div>
        </div>

        <!-- Custom Confirm Dialog -->
        <div id="customConfirm" class="modal hidden">
            <div class="modal-content">
                <div style="display: flex; align-items: center; justify-content: center; margin-bottom: 20px;">
                    <span class="winky thinking" style="font-size: 3rem; margin-right: 15px;"></span>
                    <h3 style="color: var(--ess-green); font-family: var(--heading-font);">Confirm Action</h3>
                </div>
                <p id="confirmMessage" style="margin-bottom: 25px;">Are you sure?</p>
                <div style="display: flex; gap: 15px; justify-content: center;">
                    <button class="btn btn-secondary" onclick="confirmAction(false)">Cancel</button>
                    <button class="btn btn-danger" onclick="confirmAction(true)">Confirm</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Application State
        const MANAGER_PASSWORD = "admin2024";
        let logoClickCount = 0;
        let logoClickTimer = null;
        let isManagerMode = false;
        let currentEmployee = null;
        let employeeDatabase = {};
        let currentModule = null;
        let currentChapter = 0;
        let currentQuiz = 0;
        let totalPoints = 0;
        let completedChapters = 0;
        let adaptiveData = {};
        let pendingConfirmCallback = null;
        let currentEditingModuleIndex = -1;
        let currentEditingChapterIndex = -1;
        let systemSettings = {
            managerPassword: "admin2024",
            autoLogout: 60,
            passingGrade: 80,
            quizAttempts: 3,
            adaptiveLearning: true,
            allowMobileAccess: true,
            enableNotifications: true,
            trackingEnabled: true
        };

        // Internal storage for design settings
        let designSettings = {
            colors: {
                primary: "#083915",
                secondary: "#062B0F",
                accent: "#FFD687"
            },
            typography: {
                fontFamily: "libre",
                companyTitle: "Ess-a-Bagel Training Academy",
                companySubtitle: "Master the Art of Authentic New York Bagels"
            },
            layout: {
                backgroundStyle: "gradient",
                borderRadius: "16",
                shadowStyle: "normal",
                transitionSpeed: "normal",
                goldAccents: true,
                winkyAnimations: true,
                winkyFrequency: "normal",
                winkyExpressions: true
            }
        };

        // Authentic Ess-a-Bagel Training Modules from the manual
        let trainingModules = [
            {
                id: 1,
                title: "Ess-a-Bagel Principles & Values",
                icon: "ü•Ø",
                description: "Master our mission, vision, and five core values that define our heritage",
                chapters: [
                    {
                        title: "Mission & Vision",
                        content: `
                            <div class="key-point">
                                <strong>üéØ Our Mission:</strong><br>
                                "To bestow the world with the finest New York-style bagels made with love."
                            </div>
                            
                            <h3>What This Means for You:</h3>
                            <ul>
                                <li><strong>Quality First:</strong> We only serve products we're proud of‚Äîbagels that are hand-rolled, boiled, and baked the traditional New York way</li>
                                <li><strong>Made with Love:</strong> Care and attention in every task, every interaction, every bagel</li>
                                <li><strong>Authentic Tradition:</strong> Honor traditional NY methods while embracing innovation</li>
                                <li><strong>Customer Focus:</strong> Everything we do serves guest satisfaction</li>
                            </ul>

                            <div class="key-point">
                                <strong>üåü Our Vision:</strong><br>
                                "To create a lasting legacy as the epitome of New York-style bagels ‚Äì connecting, evoking joy, and fostering cherished memories with every bite."
                            </div>

                            <h3>Strategic Goals:</h3>
                            <ul>
                                <li>Expand corporate stores and wholesale business to franchising and licensing</li>
                                <li>Target every market to meet customer needs while staying on trend</li>
                                <li>Keep up with innovation, technology, and product development</li>
                                <li>Maintain authenticity while expanding globally</li>
                            </ul>

                            <div class="tip-box">
                                <strong>üí° Remember:</strong> You are not just serving bagels‚Äîyou are serving joy, tradition, and cherished memories.
                            </div>
                        `,
                        quizzes: [
                            {
                                question: "What is Ess-a-Bagel's mission?",
                                options: [
                                    "To make the most bagels in NYC",
                                    "To bestow the world with the finest New York-style bagels made with love",
                                    "To be the fastest bagel service",
                                    "To offer the lowest prices"
                                ],
                                correct: 1,
                                points: 10
                            },
                            {
                                question: "What does 'made with love' mean in practice?",
                                options: [
                                    "Use romantic marketing",
                                    "Care and attention in every task, interaction, and bagel",
                                    "Only hire family members",
                                    "Play love songs while working"
                                ],
                                correct: 1,
                                points: 10
                            },
                            {
                                question: "How do we maintain tradition while growing?",
                                options: [
                                    "Never change anything",
                                    "Copy other successful chains",
                                    "Honor traditional methods while embracing innovation",
                                    "Focus only on speed and efficiency"
                                ],
                                correct: 2,
                                points: 15
                            }
                        ]
                    },
                    {
                        title: "Five Core Values",
                        content: `
                            <h3>üåü The Five Pillars of Ess-a-Bagel:</h3>
                            
                            <div class="key-point">
                                <strong>1. ü§ù COMMITMENT & ACCOUNTABILITY</strong><br>
                                The ability to be depended upon to do your best on behalf of the company as well as yourself.
                                <ul>
                                    <li>Take ownership of your work and responsibilities</li>
                                    <li>Keep promises to customers and teammates</li>
                                    <li>Follow through without excuses</li>
                                    <li>Own mistakes and learn constructively</li>
                                </ul>
                            </div>

                            <div class="key-point">
                                <strong>2. üë• COMMUNITY & COLLABORATION</strong><br>
                                Encompasses all of the people around you to create a sense of belonging and acceptance.
                                <ul>
                                    <li>Work as unified, supportive team</li>
                                    <li>Help coworkers during busy periods</li>
                                    <li>Serve local community with pride</li>
                                    <li>Share knowledge and help others succeed</li>
                                </ul>
                            </div>

                            <div class="key-point">
                                <strong>3. üìà GROWTH & INNOVATION</strong><br>
                                Support the growth of the company by hiring and developing the right people.
                                <ul>
                                    <li>Continuously improve your skills</li>
                                    <li>Suggest ways to enhance operations</li>
                                    <li>Embrace learning opportunities</li>
                                    <li>Break down silos to implement new ideas</li>
                                </ul>
                            </div>

                            <div class="key-point">
                                <strong>4. üéØ INTEGRITY & OWNERSHIP</strong><br>
                                Being true to your word and doing what you say with utmost respect for others.
                                <ul>
                                    <li>Do the right thing when no one watches</li>
                                    <li>Be honest in all interactions</li>
                                    <li>Take pride in representing Ess-a-Bagel</li>
                                    <li>Adhere to ethical standards</li>
                                </ul>
                            </div>

                            <div class="key-point">
                                <strong>5. ‚öñÔ∏è WORK LIFE BALANCE</strong><br>
                                Managing professional and personal responsibilities effectively.
                                <ul>
                                    <li>Do a good job while having time to recharge</li>
                                    <li>Maintain physical and mental well-being</li>
                                    <li>Support teammates' balance needs</li>
                                    <li>Work efficiently to minimize stress</li>
                                </ul>
                            </div>
                        `,
                        quizzes: [
                            {
                                question: "Which describes 'Commitment & Accountability'?",
                                options: [
                                    "Only working hard when managers are watching",
                                    "Being dependable and taking ownership of your work",
                                    "Competing with other employees",
                                    "Following rules without question"
                                ],
                                correct: 1,
                                points: 10
                            },
                            {
                                question: "How do you demonstrate 'Community & Collaboration'?",
                                options: [
                                    "Work independently without helping others",
                                    "Only focus on your assigned tasks",
                                    "Help coworkers and serve the community with pride",
                                    "Compete for the best performance reviews"
                                ],
                                correct: 2,
                                points: 10
                            },
                            {
                                question: "What does 'Growth & Innovation' encourage?",
                                options: [
                                    "Never changing established procedures",
                                    "Continuously improving skills and suggesting enhancements",
                                    "Only following orders from management",
                                    "Avoiding new responsibilities"
                                ],
                                correct: 1,
                                points: 15
                            }
                        ]
                    }
                ]
            },
            {
                id: 2,
                title: "Store Standards & Brand Excellence",
                icon: "‚≠ê",
                description: "Master the five pillars of our brand: Quality, Consistency, Cleanliness, Hospitality, and Accountability",
                chapters: [
                    {
                        title: "Quality Standards",
                        content: `
                            <div class="key-point">
                                <strong>üèÜ Quality First - No Exceptions</strong><br>
                                We only serve products we're proud of‚Äîbagels that are hand-rolled, boiled, and baked the traditional New York way.
                            </div>

                            <h3>Quality Requirements:</h3>
                            <ul>
                                <li><strong>Fresh Ingredients:</strong> All ingredients must be fresh, properly stored, and prepared using standard recipes</li>
                                <li><strong>Proper Portioning:</strong> Follow portioning guides exactly‚Äîconsistency is key</li>
                                <li><strong>Temperature Control:</strong> Adhere to temperature guidelines to prevent waste and spoilage</li>
                                <li><strong>Visual Standards:</strong> Bagels must be attractively displayed in designated trays</li>
                            </ul>

                            <h3>Visual Presentation:</h3>
                            <ul>
                                <li>Bagels not overcrowded or under-filled in displays</li>
                                <li>All signage clean, properly placed, and HQ-approved</li>
                                <li>No handwritten notes or taped signs without emergency approval</li>
                                <li>Clean glass cases and spotless surfaces</li>
                            </ul>

                            <div class="warning-box">
                                <strong>‚ö†Ô∏è Never Compromise:</strong> Do not ever allow a questionable product to be served to our guests. When you take pride in delivering the highest quality product, you create cherished memories.
                            </div>

                            <div class="tip-box">
                                <strong>üí° Quality Check:</strong> Before serving any item, ask yourself: "Would I be proud to serve this to my own family?"
                            </div>
                        `,
                        quizzes: [
                            {
                                question: "What should you do if a bagel looks questionable?",
                                options: [
                                    "Serve it anyway if the customer doesn't notice",
                                    "Never serve questionable products - maintain quality standards",
                                    "Only replace it if the customer complains",
                                    "Ask the customer if they mind"
                                ],
                                correct: 1,
                                points: 15
                            },
                            {
                                question: "How should bagels be displayed?",
                                options: [
                                    "Packed tightly to fit more",
                                    "Attractively in designated trays, not overcrowded or under-filled",
                                    "Any way that's convenient",
                                    "Only the fresh ones visible"
                                ],
                                correct: 1,
                                points: 10
                            },
                            {
                                question: "What makes our bagels special?",
                                options: [
                                    "They're the cheapest in the city",
                                    "They're made quickly",
                                    "Hand-rolled, boiled, and baked the traditional New York way",
                                    "They have the most toppings"
                                ],
                                correct: 2,
                                points: 10
                            }
                        ]
                    },
                    {
                        title: "The 10-Second Rule",
                        content: `
                            <div class="key-point">
                                <strong>‚è±Ô∏è GREET EVERY GUEST WITHIN 10 SECONDS</strong><br>
                                This is our most important service standard - NO EXCEPTIONS.
                            </div>

                            <h3>üéØ Why the 10-Second Rule Matters:</h3>
                            <ul>
                                <li><strong>First Impressions:</strong> Sets positive tone for entire experience</li>
                                <li><strong>Reduces Anxiety:</strong> Customers know they're noticed and valued</li>
                                <li><strong>Shows Respect:</strong> Demonstrates we value their time</li>
                                <li><strong>Professional Standard:</strong> Separates us from competitors</li>
                                <li><strong>Prevents Complaints:</strong> Eliminates feeling ignored or forgotten</li>
                            </ul>

                            <h3>üí¨ Perfect Greetings to Use:</h3>
                            <ul>
                                <li>"Good morning! Welcome to Ess-a-Bagel!"</li>
                                <li>"Hi there! Thanks for coming in!"</li>
                                <li>"Welcome! What can I start for you today?"</li>
                                <li>"Good afternoon! How can we help you?"</li>
                                <li>"Welcome back! Great to see you again!"</li>
                            </ul>

                            <h3>üö® When You're Busy:</h3>
                            <p>If you cannot immediately take their order, you MUST still acknowledge them within 10 seconds:</p>
                            <ul>
                                <li>"I'll be right with you!"</li>
                                <li>"Welcome! I'll be with you in just a moment!"</li>
                                <li>Make eye contact and nod in recognition</li>
                                <li>Ask a coworker to help</li>
                            </ul>

                            <div class="warning-box">
                                <strong>‚ùå Never:</strong> Ignore customers even when extremely busy. Simple acknowledgment prevents negative experiences and lost customers.
                            </div>

                            <div class="tip-box">
                                <strong>üí° Pro Tip:</strong> Make your introduction powerful and exciting. Vary your greeting so people don't feel like a number. Show enthusiasm for our signature items and daily specials!
                            </div>
                        `,
                        quizzes: [
                            {
                                question: "How quickly must you greet every guest?",
                                options: [
                                    "Within 5 seconds",
                                    "Within 10 seconds",
                                    "Within 30 seconds",
                                    "When you have time"
                                ],
                                correct: 1,
                                points: 15
                            },
                            {
                                question: "What should you do when busy with another customer?",
                                options: [
                                    "Ignore new customers until you're free",
                                    "Make eye contact and say 'I'll be right with you'",
                                    "Point to the menu",
                                    "Rush through the current order"
                                ],
                                correct: 1,
                                points: 15
                            },
                            {
                                question: "Why is the 10-second rule important?",
                                options: [
                                    "It's just a company policy",
                                    "Sets positive tone, shows respect, and prevents complaints",
                                    "Makes us look organized",
                                    "Helps us work faster"
                                ],
                                correct: 1,
                                points: 10
                            }
                        ]
                    }
                ]
            },
            {
                id: 3,
                title: "Customer Service Excellence",
                icon: "ü§ù",
                description: "Master the art of creating delighted guests who become part of our Ess-a-Bagel family",
                chapters: [
                    {
                        title: "The Guest Experience Philosophy",
                        content: `
                            <div class="key-point">
                                <strong>üéØ Our Philosophy:</strong> The Guest is Always Right<br>
                                Every guest receives nothing less than the highest degree of respect and courtesy.
                            </div>

                            <h3>Creating Delighted Guests:</h3>
                            <p>In the eyes of our guests, you represent Ess-a-Bagel and serve as a role model. You don't just serve food - guests are also buying "great feelings" and memorable experiences.</p>

                            <h3>üåü Three Main Goals:</h3>
                            <div class="key-point">
                                <strong>1. üåû THINKING POSITIVELY</strong><br>
                                Positive thinkers achieve twice as many goals as negative thinkers.
                                <ul>
                                    <li>Always be solution-oriented and up for change</li>
                                    <li>Look at the sunny side of every situation</li>
                                    <li>Ask: "How can I make this right for the guest?"</li>
                                </ul>
                            </div>

                            <div class="key-point">
                                <strong>2. üë• MAKING FRIENDS WITH EVERY GUEST</strong><br>
                                Treat each guest like someone special you'd love to meet.
                                <ul>
                                    <li>Light up with excitement to serve them</li>
                                    <li>Learn their names and favorite menu items</li>
                                    <li>Make them feel part of our Ess-a-Bagel family</li>
                                </ul>
                            </div>

                            <div class="key-point">
                                <strong>3. üöÄ DELIVERING EXCEPTIONAL SERVICE</strong><br>
                                Go above and beyond to create unsurpassed service.
                                <ul>
                                    <li>Think outside the box to exceed expectations</li>
                                    <li>Anticipate needs before guests ask</li>
                                    <li>Remember: their experience creates lasting memories</li>
                                </ul>
                            </div>

                            <h3>The Three L's - Listen, Look, Learn:</h3>
                            <ul>
                                <li><strong>Listen:</strong> To what the guest says</li>
                                <li><strong>Look:</strong> At their nonverbal body language and gestures</li>
                                <li><strong>Learn:</strong> Their individual needs and preferences</li>
                            </ul>

                            <div class="tip-box">
                                <strong>üí° Remember:</strong> Perception is not the way things are, but the way people think things are. When guests perceive value in their experience, everyone wins.
                            </div>
                        `,
                        quizzes: [
                            {
                                question: "What are guests buying besides great food?",
                                options: [
                                    "Just food and nothing else",
                                    "Great feelings and memorable experiences",
                                    "Fast service only",
                                    "Low prices"
                                ],
                                correct: 1,
                                points: 10
                            },
                            {
                                question: "What should you ask when facing a challenge?",
                                options: [
                                    "How can I avoid this problem?",
                                    "How can I make this right for the guest?",
                                    "Is this worth my time?",
                                    "Can someone else handle this?"
                                ],
                                correct: 1,
                                points: 15
                            },
                            {
                                question: "What do the Three L's stand for?",
                                options: [
                                    "Like, Love, Live",
                                    "Listen, Look, Learn",
                                    "Lead, Laugh, Light",
                                    "Lunch, Learn, Leave"
                                ],
                                correct: 1,
                                points: 10
                            }
                        ]
                    }
                ]
            },
            {
                id: 4,
                title: "Safety & Sanitation Mastery",
                icon: "üßº",
                description: "Essential safety procedures and sanitation guidelines to protect our team and guests",
                chapters: [
                    {
                        title: "Hand Washing & Hygiene",
                        content: `
                            <div class="key-point">
                                <strong>üßº Frequent Hand Washing is Essential</strong><br>
                                Proper hand washing prevents the spread of bacteria and protects you, your teammates, and our guests.
                            </div>

                            <h3>When to Wash Your Hands:</h3>
                            <ul>
                                <li>Before starting work</li>
                                <li>Before handling food</li>
                                <li>Before handling clean plateware and utensils</li>
                                <li>After using the restroom</li>
                                <li>After taking out trash</li>
                                <li>After eating or taking breaks</li>
                                <li>After coughing, sneezing, or using tissues</li>
                                <li>After touching unsanitary areas (face, hair)</li>
                                <li>After handling money</li>
                                <li>After any cleaning duties</li>
                            </ul>

                            <h3>üß¥ Proper Hand Washing Technique:</h3>
                            <div class="key-point">
                                <strong>8-Step Process:</strong>
                                <ol>
                                    <li>Use hand washing sink (not food prep sink)</li>
                                    <li>Use water as hot as you can comfortably stand</li>
                                    <li>Apply soap thoroughly, lathering to your elbows</li>
                                    <li>Rub hands together for 20 seconds minimum</li>
                                    <li>Wash backs of hands, wrists, between fingers, under nails</li>
                                    <li>Rinse hands and arms well under warm running water</li>
                                    <li>Turn off water with paper towel (not bare hands)</li>
                                    <li>Dry hands with single-use paper towel or air dryer</li>
                                </ol>
                            </div>

                            <div class="tip-box">
                                <strong>üí° Alternative:</strong> Antibacterial liquid can also be used to sanitize hands, but proper washing is always preferred.
                            </div>

                            <h3>Personal Hygiene Standards:</h3>
                            <ul>
                                <li>Uniforms must be clean and complete</li>
                                <li>Hair tied back and covered</li>
                                <li>No heavy perfume or cologne</li>
                                <li>Clean, well-groomed appearance</li>
                                <li>Proper safety-approved footwear</li>
                            </ul>
                        `,
                        quizzes: [
                            {
                                question: "How long should you rub your hands together when washing?",
                                options: [
                                    "10 seconds",
                                    "20 seconds minimum",
                                    "5 seconds",
                                    "30 seconds"
                                ],
                                correct: 1,
                                points: 10
                            },
                            {
                                question: "What should you use to turn off the water?",
                                options: [
                                    "Your bare hands",
                                    "Paper towel",
                                    "Your elbow",
                                    "Let it run"
                                ],
                                correct: 1,
                                points: 10
                            },
                            {
                                question: "When must you wash your hands? (Select the most complete answer)",
                                options: [
                                    "Only before eating",
                                    "Only after using the restroom",
                                    "Before handling food, after restroom, money, breaks, and cleaning",
                                    "Only when they look dirty"
                                ],
                                correct: 2,
                                points: 15
                            }
                        ]
                    }
                ]
            },
            {
                id: 5,
                title: "POS System & Order Management",
                icon: "üí≥",
                description: "Master the Toast POS system and efficient order processing",
                chapters: [
                    {
                        title: "Toast POS Fundamentals",
                        content: `
                            <div class="key-point">
                                <strong>üíª Toast POS System</strong><br>
                                Ess-a-Bagel uses Toast POS for order processing, sales, and various operational functions. Mastering this system is essential for your success.
                            </div>

                            <h3>Order Taking Best Practices:</h3>
                            <ul>
                                <li><strong>Take Your Time:</strong> Don't rush - accuracy prevents costly remakes</li>
                                <li><strong>Make Suggestions:</strong> Name specific menu items vs. general food groups</li>
                                <li><strong>Ask Proper Questions:</strong> Size, cooking method, sides, condiments, etc.</li>
                                <li><strong>Verify Orders:</strong> Always read back the order from the screen</li>
                                <li><strong>Double-Check:</strong> Review accuracy before pressing function keys</li>
                            </ul>

                            <h3>üéØ Order Taking Procedure:</h3>
                            <div class="key-point">
                                <strong>9-Step Process:</strong>
                                <ol>
                                    <li>Determine next person in line</li>
                                    <li>Smile and be friendly</li>
                                    <li>Welcome the guest warmly</li>
                                    <li>Suggest specific items and specials</li>
                                    <li>Ensure previous order was closed and paid</li>
                                    <li>Take order while inputting into computer</li>
                                    <li>Collect payment (follow payment procedures)</li>
                                    <li>Provide receipt with order</li>
                                    <li>Thank the guest sincerely</li>
                                </ol>
                            </div>

                            <h3>Payment Processing:</h3>
                            <div class="key-point">
                                <strong>üí≥ Card Payments:</strong>
                                <ol>
                                    <li>Tap 'Pay' or 'Checkout' on order screen</li>
                                    <li>Guest payment screen shows total and tip options</li>
                                    <li>Ask how they'd like to pay</li>
                                    <li>Insert, swipe, or tap card on reader</li>
                                    <li>Wait for Toast to process and confirm</li>
                                    <li>Handle tip selection if enabled</li>
                                    <li>Tap 'Done' to complete transaction</li>
                                </ol>
                            </div>

                            <div class="tip-box">
                                <strong>üí° Pro Tips:</strong>
                                <ul>
                                    <li>Confirm orders clearly to avoid mistakes</li>
                                    <li>Speak with a welcoming tone</li>
                                    <li>Always confirm payment method before proceeding</li>
                                    <li>Ensure guests receive receipts if requested</li>
                                </ul>
                            </div>

                            <div class="warning-box">
                                <strong>‚ö†Ô∏è Troubleshooting:</strong>
                                <ul>
                                    <li><strong>Item Not Found:</strong> Use search bar or ask manager</li>
                                    <li><strong>Payment Issues:</strong> Retry payment or check connection</li>
                                    <li><strong>Screen Freezing:</strong> Restart Toast or report to tech support</li>
                                </ul>
                            </div>
                        `,
                        quizzes: [
                            {
                                question: "What should you do before pressing any function key?",
                                options: [
                                    "Press it quickly",
                                    "Read the screen and verify information",
                                    "Ask the customer to confirm",
                                    "Check with your manager"
                                ],
                                correct: 1,
                                points: 15
                            },
                            {
                                question: "How should you handle payment processing?",
                                options: [
                                    "Process it as fast as possible",
                                    "Confirm payment method, process carefully, and ensure completion",
                                    "Let the customer handle everything",
                                    "Only accept cash"
                                ],
                                correct: 1,
                                points: 10
                            },
                            {
                                question: "What's the most important step in order taking?",
                                options: [
                                    "Speed of service",
                                    "Accuracy and verification",
                                    "Upselling extras",
                                    "Processing payment quickly"
                                ],
                                correct: 1,
                                points: 10
                            }
                        ]
                    }
                ]
            }
        ];

        // Initialize Application
        function initializeApp() {
            showScreen('loginScreen');
            initializeSampleData();
            setupEventListeners();
            resetState();
            loadSavedDesign();
            updateCurrentURL();
            console.log('ü•Ø Ess-a-Bagel Training Academy initialized successfully with Winky!');
        }

        function updateCurrentURL() {
            const urlElement = document.getElementById('currentURL');
            if (urlElement) {
                urlElement.textContent = window.location.href;
            }
        }

        function resetState() {
            currentEmployee = null;
            totalPoints = 0;
            completedChapters = 0;
            isManagerMode = false;
            logoClickCount = 0;
            currentModule = null;
            currentChapter = 0;
            currentQuiz = 0;
            
            const empId = document.getElementById('empId');
            const empName = document.getElementById('empName');
            const empDept = document.getElementById('empDept');
            
            if (empId) empId.value = '';
            if (empName) empName.value = '';
            if (empDept) empDept.value = '';
        }

        function showScreen(screenId) {
            const screens = ['loginScreen', 'trainingInterface', 'managerDashboard'];
            screens.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    if (id === screenId) {
                        element.classList.remove('hidden');
                    } else {
                        element.classList.add('hidden');
                    }
                }
            });
        }

        function initializeSampleData() {
            if (Object.keys(employeeDatabase).length === 0) {
                employeeDatabase['EMP001'] = {
                    id: 'EMP001',
                    name: 'Sarah Johnson',
                    department: 'Cashier/Counter Service',
                    progress: {1: {completed: true, chaptersCompleted: 2}, 2: {completed: false, chaptersCompleted: 1}},
                    totalPoints: 120,
                    completedChapters: 3,
                    sessions: [{startTime: new Date().toISOString(), pointsEarned: 120}]
                };
                
                employeeDatabase['EMP002'] = {
                    id: 'EMP002',
                    name: 'Mike Chen',
                    department: 'Kitchen & Food Prep',
                    progress: {1: {completed: true, chaptersCompleted: 2}},
                    totalPoints: 90,
                    completedChapters: 2,
                    sessions: [{startTime: new Date().toISOString(), pointsEarned: 90}]
                };
            }
        }

        function setupEventListeners() {
            document.addEventListener('keydown', function(event) {
                if (event.ctrlKey && event.shiftKey && event.key === 'M') {
                    event.preventDefault();
                    showPasswordModal();
                }
            });
        }

        // Logo Click Counter for Hidden Manager Access
        function logoClickCounter() {
            logoClickCount++;
            
            // Add celebration effect to Winky
            event.target.classList.add('celebrate');
            setTimeout(() => {
                event.target.classList.remove('celebrate');
            }, 2000);
            
            if (logoClickTimer) {
                clearTimeout(logoClickTimer);
            }
            
            logoClickTimer = setTimeout(() => {
                logoClickCount = 0;
            }, 1000);
            
            if (logoClickCount >= 3) {
                logoClickCount = 0;
                showPasswordModal();
            }
        }

        // Manager Access Functions
        function showPasswordModal() {
            document.getElementById('passwordModal').classList.remove('hidden');
            document.getElementById('managerPassword').focus();
        }

        function closePasswordModal() {
            document.getElementById('passwordModal').classList.add('hidden');
            document.getElementById('managerPassword').value = '';
        }

        function checkPasswordEnter(event) {
            if (event.key === 'Enter') {
                verifyManagerPassword();
            }
        }

        function verifyManagerPassword() {
            const password = document.getElementById('managerPassword').value;
            
            if (password === systemSettings.managerPassword) {
                isManagerMode = true;
                closePasswordModal();
                showManagerView();
                showNotification('ü•Ø Admin access granted! Welcome, manager!', 'success');
            } else {
                showNotification('‚ùå Incorrect password! Access denied.', 'error');
                document.getElementById('managerPassword').value = '';
            }
        }

        // Training Functions
        function startTraining() {
            const empId = document.getElementById('empId').value.trim();
            const empName = document.getElementById('empName').value.trim();
            const empDept = document.getElementById('empDept').value;
            
            if (!empId || !empName || !empDept) {
                showNotification('Please fill in all fields to continue your bagel journey! ü•Ø', 'warning');
                return;
            }
            
            currentEmployee = {
                id: empId,
                name: empName,
                department: empDept,
                startTime: new Date().toISOString()
            };
            
            if (!employeeDatabase[empId]) {
                employeeDatabase[empId] = {
                    id: empId,
                    name: empName,
                    department: empDept,
                    progress: {},
                    totalPoints: 0,
                    completedChapters: 0,
                    sessions: []
                };
            }
            
            totalPoints = employeeDatabase[empId].totalPoints || 0;
            completedChapters = employeeDatabase[empId].completedChapters || 0;
            
            showTrainingInterface();
            showNotification(`üéâ Welcome to the team, ${empName}! Let's start your Ess-a-Bagel journey!`, 'success');
        }

        function showTrainingInterface() {
            showScreen('trainingInterface');
            
            document.getElementById('currentEmployee').textContent = currentEmployee.name;
            document.getElementById('employeeDept').textContent = currentEmployee.department;
            
            renderTrainingModules();
            updateEmployeeStats();
            updateAdaptiveDashboard();
        }

        function showManagerView() {
            if (!isManagerMode) {
                showNotification('üîê Admin access required! Triple-click Winky for access.', 'warning');
                return;
            }
            
            showScreen('managerDashboard');
            updateManagerStats();
            renderEmployeesList();
            renderModulesList();
            document.getElementById('currentURL').textContent = window.location.href;
        }

        function logout() {
            showScreen('loginScreen');
            resetState();
            showNotification('üëã Thanks for visiting Ess-a-Bagel Training Academy!', 'info');
        }

        // Training Module Rendering
        function renderTrainingModules() {
            const container = document.getElementById('modulesDisplay');
            container.innerHTML = '';
            
            trainingModules.forEach(module => {
                const progress = employeeDatabase[currentEmployee.id].progress[module.id] || { completed: false, chaptersCompleted: 0 };
                const isCompleted = progress.completed;
                const isLocked = module.id > 1 && !employeeDatabase[currentEmployee.id].progress[module.id - 1]?.completed;
                
                const moduleDiv = document.createElement('div');
                moduleDiv.className = 'module-card' + (isCompleted ? ' completed' : '') + (isLocked ? ' locked' : '');
                
                const statusText = isCompleted ? '‚úÖ Complete' : isLocked ? 'üîí Locked' : '‚ñ∂Ô∏è Start Learning';
                const totalPoints = module.chapters.reduce((sum, ch) => sum + ch.quizzes.reduce((qSum, q) => qSum + q.points, 0), 0);
                
                moduleDiv.innerHTML = `
                    <div class="module-header">
                        <span class="module-icon">${module.icon}</span>
                        <div>
                            <div class="module-title">Module ${module.id}: ${module.title}</div>
                            <div class="module-description">${module.description}</div>
                        </div>
                    </div>
                    
                    <div style="margin: 20px 0;">
                        <div style="background: var(--cream-white); padding: 15px; border-radius: var(--border-radius-sm); margin-bottom: 15px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <span>üìö ${module.chapters.length} chapters</span>
                                <span class="gold-accent">üèÜ ${totalPoints} total points</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${((progress.chaptersCompleted || 0) / module.chapters.length) * 100}%"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="module-footer">
                        <div style="font-weight: 600; color: var(--text-dark);">
                            ${progress.chaptersCompleted || 0}/${module.chapters.length} chapters completed
                        </div>
                        <div style="color: ${isCompleted ? 'var(--success-color)' : isLocked ? 'var(--text-light)' : 'var(--ess-green)'}; font-weight: 600; display: flex; align-items: center; gap: 8px;">
                            <span class="winky" style="font-size: 1.2rem;"></span>
                            ${statusText}
                        </div>
                    </div>
                `;
                
                if (!isLocked) {
                    moduleDiv.onclick = () => startModule(module.id);
                }
                
                container.appendChild(moduleDiv);
            });
        }

        function startModule(moduleId) {
            currentModule = trainingModules.find(m => m.id === moduleId);
            currentChapter = 0;
            currentQuiz = 0;
            showLesson();
            showNotification(`üéì Starting ${currentModule.title}! Let's learn together!`, 'info');
        }

        function showLesson() {
            document.getElementById('dashboard').classList.add('hidden');
            document.getElementById('lessonView').classList.remove('hidden');
            
            const chapter = currentModule.chapters[currentChapter];
            document.getElementById('moduleProgress').textContent = currentModule.title;
            document.getElementById('chapterNum').textContent = currentChapter + 1;
            document.getElementById('totalChapters').textContent = currentModule.chapters.length;
            document.getElementById('lessonTitle').textContent = chapter.title;
            document.getElementById('lessonText').innerHTML = chapter.content;
            document.getElementById('progressFill').style.width = ((currentChapter + 1) / currentModule.chapters.length * 100) + '%';
            
            document.getElementById('lessonContent').classList.remove('hidden');
            document.getElementById('quizSection').classList.add('hidden');
            document.getElementById('takeQuizBtn').classList.remove('hidden');
            document.getElementById('nextChapterBtn').classList.add('hidden');
        }

        function startQuizSequence() {
            currentQuiz = 0;
            document.getElementById('lessonContent').classList.add('hidden');
            document.getElementById('quizSection').classList.remove('hidden');
            document.getElementById('takeQuizBtn').classList.add('hidden');
            
            setupQuizTabs();
            showCurrentQuiz();
            showNotification('üß† Time to test your knowledge! You\'ve got this!', 'info');
        }

        function setupQuizTabs() {
            const container = document.getElementById('quizSelector');
            container.innerHTML = '';
            
            for (let i = 0; i < 3; i++) {
                const tab = document.createElement('div');
                tab.className = 'quiz-tab' + (i === 0 ? ' active' : '');
                tab.innerHTML = 'Quiz ' + (i + 1);
                tab.onclick = () => selectQuiz(i);
                container.appendChild(tab);
            }
        }

        function selectQuiz(index) {
            currentQuiz = index;
            
            const tabs = document.querySelectorAll('.quiz-tab');
            tabs.forEach((tab, i) => {
                tab.classList.remove('active');
                if (i === index) {
                    tab.classList.add('active');
                }
            });
            
            showCurrentQuiz();
        }

        function showCurrentQuiz() {
            const quiz = currentModule.chapters[currentChapter].quizzes[currentQuiz];
            document.getElementById('questionText').textContent = quiz.question;
            document.getElementById('quizProgress').textContent = `Quiz ${currentQuiz + 1} of 3`;
            
            const container = document.getElementById('optionsContainer');
            container.innerHTML = '';
            
            quiz.options.forEach((option, index) => {
                const button = document.createElement('button');
                button.className = 'quiz-option';
                button.innerHTML = `<span style="background: var(--sophisticated-gray); color: var(--text-dark); width: 35px; height: 35px; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; font-weight: bold; margin-right: 15px;">${String.fromCharCode(65 + index)}</span>${option}`;
                button.onclick = () => selectAnswer(index);
                container.appendChild(button);
            });
        }

        function selectAnswer(answerIndex) {
            const quiz = currentModule.chapters[currentChapter].quizzes[currentQuiz];
            const isCorrect = answerIndex === quiz.correct;
            
            const buttons = document.querySelectorAll('.quiz-option');
            buttons.forEach((btn, i) => {
                btn.onclick = null;
                if (i === answerIndex) {
                    btn.classList.add(isCorrect ? 'correct' : 'incorrect');
                }
                if (i === quiz.correct && !isCorrect) {
                    btn.classList.add('correct');
                }
            });
            
            updateAdaptiveData(currentModule.id, currentChapter, currentQuiz, isCorrect);
            
            const currentTab = document.querySelectorAll('.quiz-tab')[currentQuiz];
            currentTab.classList.remove('active');
            currentTab.classList.add(isCorrect ? 'completed' : 'failed');
            
            const points = isCorrect ? quiz.points : 0;
            if (isCorrect) {
                totalPoints += points;
                employeeDatabase[currentEmployee.id].totalPoints = totalPoints;
            }
            
            setTimeout(() => {
                if (currentQuiz < 2) {
                    document.getElementById('nextQuizBtn').style.display = 'block';
                } else {
                    const allCorrect = checkAllQuizzesCompleted();
                    if (allCorrect) {
                        completedChapters++;
                        employeeDatabase[currentEmployee.id].completedChapters = completedChapters;
                        
                        if (!employeeDatabase[currentEmployee.id].progress[currentModule.id]) {
                            employeeDatabase[currentEmployee.id].progress[currentModule.id] = { chaptersCompleted: 0 };
                        }
                        employeeDatabase[currentEmployee.id].progress[currentModule.id].chaptersCompleted = Math.max(
                            employeeDatabase[currentEmployee.id].progress[currentModule.id].chaptersCompleted || 0,
                            currentChapter + 1
                        );
                        
                        if (currentChapter >= currentModule.chapters.length - 1) {
                            employeeDatabase[currentEmployee.id].progress[currentModule.id].completed = true;
                        }
                    }
                    
                    showCompletionModal(points, isCorrect, allCorrect);
                }
            }, 2000);
        }

        function nextQuiz() {
            currentQuiz++;
            selectQuiz(currentQuiz);
            document.getElementById('nextQuizBtn').style.display = 'none';
        }

        function checkAllQuizzesCompleted() {
            const tabs = document.querySelectorAll('.quiz-tab');
            let completedCount = 0;
            
            tabs.forEach(tab => {
                if (tab.classList.contains('completed')) {
                    completedCount++;
                }
            });
            
            return completedCount >= Math.ceil(tabs.length * 0.67); // Need at least 67% correct
        }

        function showCompletionModal(points, isCorrect, canProceed) {
            const modalEmoji = canProceed ? 'üéâ' : isCorrect ? '‚úÖ' : 'üìö';
            const modalTitle = canProceed ? 'Chapter Mastered!' : isCorrect ? 'Correct!' : 'Keep Learning!';
            const modalMessage = canProceed ? 
                'Outstanding! You\'ve mastered this chapter of Ess-a-Bagel training!' :
                isCorrect ? 'Great job! Winky is proud of you!' : 
                'Good effort! Review the material and try again. Remember, every bagel expert started somewhere!';
            
            const masteryLevel = canProceed ? 'Bagel Expert' : isCorrect ? 'Progressing Well' : 'Learning in Progress';
            
            document.getElementById('modalEmoji').textContent = modalEmoji;
            document.getElementById('modalTitle').textContent = modalTitle;
            document.getElementById('modalMessage').textContent = modalMessage;
            document.getElementById('earnedPoints').textContent = '+' + points;
            document.getElementById('quizScore').textContent = isCorrect ? '100%' : '0%';
            document.getElementById('masteryLevel').textContent = masteryLevel;
            document.getElementById('modal').classList.remove('hidden');
        }

        function closeModal() {
            document.getElementById('modal').classList.add('hidden');
            
            const allCorrect = checkAllQuizzesCompleted();
            if (allCorrect) {
                if (currentChapter >= currentModule.chapters.length - 1) {
                    showNotification('üéì Module completed! You\'re becoming a true Ess-a-Bagel expert!', 'success');
                    backToDashboard();
                } else {
                    document.getElementById('nextChapterBtn').classList.remove('hidden');
                }
            } else {
                showNotification('Complete remaining quizzes to master this chapter! ü•Ø', 'info');
            }
        }

        function nextChapter() {
            currentChapter++;
            currentQuiz = 0;
            showLesson();
        }

        function backToDashboard() {
            document.getElementById('lessonView').classList.add('hidden');
            document.getElementById('dashboard').classList.remove('hidden');
            renderTrainingModules();
            updateEmployeeStats();
        }

        function updateEmployeeStats() {
            const totalChapters = trainingModules.reduce((sum, module) => sum + module.chapters.length, 0);
            const progressPercent = Math.round((completedChapters / totalChapters) * 100);
            
            document.getElementById('totalPoints').textContent = totalPoints;
            document.getElementById('chaptersCompleted').textContent = completedChapters;
            document.getElementById('overallProgress').textContent = progressPercent + '%';
        }

        // Adaptive Learning Functions
        function updateAdaptiveData(moduleId, chapterId, quizIndex, correct) {
            const key = `${moduleId}_${chapterId}_${quizIndex}`;
            if (!adaptiveData[currentEmployee.id]) {
                adaptiveData[currentEmployee.id] = {};
            }
            
            if (!adaptiveData[currentEmployee.id][key]) {
                adaptiveData[currentEmployee.id][key] = {
                    attempts: 0,
                    correct: 0,
                    lastScore: 0
                };
            }
            
            adaptiveData[currentEmployee.id][key].attempts++;
            if (correct) {
                adaptiveData[currentEmployee.id][key].correct++;
            }
            adaptiveData[currentEmployee.id][key].lastScore = correct ? 100 : 0;
            
            updateAdaptiveDashboard();
        }

        function updateAdaptiveDashboard() {
            const weakAreas = [];
            const strongAreas = [];
            
            if (adaptiveData[currentEmployee.id]) {
                Object.keys(adaptiveData[currentEmployee.id]).forEach(key => {
                    const data = adaptiveData[currentEmployee.id][key];
                    const successRate = (data.correct / data.attempts) * 100;
                    const parts = key.split('_');
                    const moduleId = parseInt(parts[0]);
                    const chapterId = parseInt(parts[1]);
                    const quizIndex = parseInt(parts[2]);
                    
                    const module = trainingModules.find(m => m.id === moduleId);
                    if (module && module.chapters[chapterId]) {
                        const chapter = module.chapters[chapterId];
                        
                        const area = {
                            module: module.title,
                            chapter: chapter.title,
                            quiz: quizIndex + 1,
                            rate: successRate,
                            attempts: data.attempts
                        };
                        
                        if (successRate < 70) {
                            weakAreas.push(area);
                        } else if (successRate >= 90) {
                            strongAreas.push(area);
                        }
                    }
                });
            }
            
            const weaknessDiv = document.getElementById('weaknessAreas');
            const strengthDiv = document.getElementById('strengthAreas');
            
            if (weakAreas.length > 0) {
                document.getElementById('adaptiveDashboard').classList.remove('hidden');
                weaknessDiv.innerHTML = '<h4>üéØ Areas for Review:</h4>' + 
                    weakAreas.map(area => 
                        `<div style="margin: 8px 0;">${area.module} - ${area.chapter} (Quiz ${area.quiz}) <span style="background: var(--danger-color); color: var(--white); padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; margin-left: 10px;">${Math.round(area.rate)}%</span></div>`
                    ).join('');
            } else {
                weaknessDiv.innerHTML = '';
            }
            
            if (strongAreas.length > 0) {
                strengthDiv.innerHTML = '<h4>üí™ Your Strengths:</h4>' + 
                    strongAreas.map(area => 
                        `<div style="margin: 8px 0;">${area.module} - ${area.chapter} (Quiz ${area.quiz}) <span style="background: var(--success-color); color: var(--white); padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; margin-left: 10px;">${Math.round(area.rate)}%</span></div>`
                    ).join('');
            } else {
                strengthDiv.innerHTML = '';
            }
            
            let totalAttempts = 0;
            let totalCorrect = 0;
            
            if (adaptiveData[currentEmployee.id]) {
                Object.values(adaptiveData[currentEmployee.id]).forEach(data => {
                    totalAttempts += data.attempts;
                    totalCorrect += data.correct;
                });
            }
            
            const masteryScore = totalAttempts > 0 ? Math.round((totalCorrect / totalAttempts) * 100) : 100;
            document.getElementById('adaptiveScore').textContent = masteryScore + '%';
        }

        function startAdaptiveReview() {
            showNotification('üéØ Starting personalized review session...', 'info');
        }

        // Admin Tab Management
        function showAdminTab(tabName) {
            // Update navigation
            document.querySelectorAll('.admin-nav .nav-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Show corresponding content
            document.querySelectorAll('.tab-content > div').forEach(tab => {
                tab.classList.remove('active');
                tab.style.display = 'none';
            });
            const targetTab = document.getElementById(tabName + 'Tab');
            if (targetTab) {
                targetTab.classList.add('active');
                targetTab.style.display = 'block';
            }
            
            // Load specific content based on tab
            switch(tabName) {
                case 'modules':
                    renderModulesList();
                    break;
                case 'design':
                    loadDesignEditor();
                    break;
                case 'dashboard':
                    updateManagerStats();
                    renderEmployeesList();
                    break;
            }
        }

        // Manager Dashboard Functions
        function updateManagerStats() {
            const totalEmps = Object.keys(employeeDatabase).length;
            let completedEmps = 0;
            let totalScores = 0;
            let totalSessions = 0;
            
            Object.values(employeeDatabase).forEach(emp => {
                const totalChapters = trainingModules.reduce((sum, m) => sum + m.chapters.length, 0);
                if (emp.completedChapters >= totalChapters) completedEmps++;
                totalScores += emp.totalPoints || 0;
                totalSessions += (emp.sessions || []).length;
            });
            
            document.getElementById('totalEmployees').textContent = totalEmps;
            document.getElementById('completedEmployees').textContent = completedEmps;
            document.getElementById('avgScore').textContent = totalEmps > 0 ? Math.round((totalScores / totalEmps) / 5) + '%' : '0%';
            document.getElementById('totalHours').textContent = Math.round(totalSessions * 0.75);
        }

        function renderEmployeesList() {
            const container = document.getElementById('employeesList');
            if (!container) return;
            
            container.innerHTML = '';
            
            if (Object.keys(employeeDatabase).length === 0) {
                container.innerHTML = '<div style="text-align: center; color: var(--text-light); padding: 40px;">No employee data yet. Data will appear after employees complete training.</div>';
                return;
            }
            
            Object.values(employeeDatabase).forEach(emp => {
                const totalChapters = trainingModules.reduce((sum, m) => sum + m.chapters.length, 0);
                const progressPercent = Math.round(((emp.completedChapters || 0) / totalChapters) * 100);
                const status = progressPercent >= 100 ? 'Complete' : progressPercent > 0 ? 'In Progress' : 'Not Started';
                const statusColor = progressPercent >= 100 ? 'var(--success-color)' : progressPercent > 0 ? 'var(--golden-crust)' : 'var(--danger-color)';
                
                const card = document.createElement('div');
                card.className = 'employee-card';
                card.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div style="flex: 1;">
                            <div style="display: flex; align-items: center; margin-bottom: 10px;">
                                <span class="winky" style="font-size: 1.5rem; margin-right: 10px;"></span>
                                <h4 style="margin: 0; color: var(--ess-green); font-size: 20px; font-family: var(--heading-font);">${emp.name}</h4>
                            </div>
                            <p style="margin: 8px 0; color: var(--text-light);">ID: ${emp.id} | Department: ${emp.department}</p>
                            <div style="margin-top: 15px;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                    <span>Progress: ${progressPercent}%</span>
                                    <span class="gold-accent">Points: ${emp.totalPoints || 0}</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: ${progressPercent}%"></div>
                                </div>
                            </div>
                        </div>
                        <div style="text-align: right; margin-left: 25px;">
                            <div style="color: ${statusColor}; font-weight: bold; font-size: 18px;">${status}</div>
                            <div style="color: var(--text-light); margin-top: 5px;">${emp.completedChapters || 0}/${totalChapters} chapters</div>
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function filterEmployees() {
            const search = document.getElementById('searchEmployee').value.toLowerCase();
            const cards = document.querySelectorAll('.employee-card');
            
            cards.forEach(card => {
                const text = card.textContent.toLowerCase();
                card.style.display = text.includes(search) ? 'block' : 'none';
            });
        }

        function refreshData() {
            updateManagerStats();
            renderEmployeesList();
            showNotification('üîÑ Data refreshed successfully!', 'success');
        }

        function clearAllData() {
            showCustomConfirm('Are you sure you want to clear ALL employee training data? This cannot be undone!', (confirmed) => {
                if (confirmed) {
                    employeeDatabase = {};
                    adaptiveData = {};
                    updateManagerStats();
                    renderEmployeesList();
                    showNotification('üóëÔ∏è All data cleared!', 'warning');
                }
            });
        }

        function exportAllData() {
            let data = 'Employee ID,Name,Department,Chapters Completed,Total Points,Status,Mastery Level\n';
            Object.values(employeeDatabase).forEach(emp => {
                const totalChapters = trainingModules.reduce((sum, m) => sum + m.chapters.length, 0);
                const progressPercent = Math.round(((emp.completedChapters || 0) / totalChapters) * 100);
                const status = progressPercent >= 100 ? 'Complete' : progressPercent > 0 ? 'In Progress' : 'Not Started';
                
                let masteryLevel = 'Not Assessed';
                if (adaptiveData[emp.id]) {
                    let totalAttempts = 0;
                    let totalCorrect = 0;
                    Object.values(adaptiveData[emp.id]).forEach(data => {
                        totalAttempts += data.attempts;
                        totalCorrect += data.correct;
                    });
                    if (totalAttempts > 0) {
                        const masteryScore = Math.round((totalCorrect / totalAttempts) * 100);
                        masteryLevel = masteryScore >= 90 ? 'Bagel Expert' : masteryScore >= 80 ? 'Proficient' : masteryScore >= 70 ? 'Developing' : 'Needs Review';
                    }
                }
                
                data += `${emp.id},${emp.name},${emp.department},${emp.completedChapters || 0},${emp.totalPoints || 0},${status},${masteryLevel}\n`;
            });
            
            const blob = new Blob([data], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'ess-a-bagel-training-report.csv';
            a.click();
            window.URL.revokeObjectURL(url);
            showNotification('üì• Training report exported successfully!', 'success');
        }

        // Module Management Functions
        function renderModulesList() {
            const container = document.getElementById('modulesList');
            if (!container) return;
            
            container.innerHTML = '';
            
            trainingModules.forEach((module, index) => {
                const moduleDiv = document.createElement('div');
                moduleDiv.className = 'module-list-item';
                moduleDiv.style.cssText = 'background: var(--white); border: 1px solid var(--border-color); border-radius: var(--border-radius-sm); padding: 20px; margin: 15px 0; display: flex; justify-content: space-between; align-items: center; transition: var(--transition);';
                moduleDiv.innerHTML = `
                    <div style="display: flex; align-items: center;">
                        <span style="font-size: 2.5rem; margin-right: 15px;">${module.icon}</span>
                        <div>
                            <h3 style="color: var(--ess-green); font-family: var(--heading-font); margin: 0;">${module.title}</h3>
                            <p style="margin: 5px 0; color: var(--text-light);">${module.description}</p>
                            <small style="color: var(--text-light);">${module.chapters.length} chapters</small>
                        </div>
                    </div>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <button class="btn btn-small btn-info" onclick="editModule(${index})">‚úèÔ∏è Edit</button>
                        <button class="btn btn-small btn-danger" onclick="removeModule(${index})">üóëÔ∏è Delete</button>
                        <span class="winky" style="font-size: 1.5rem;"></span>
                    </div>
                `;
                container.appendChild(moduleDiv);
            });
        }

        function addNewModule() {
            currentEditingModuleIndex = -1;
            document.getElementById('moduleEditorTitle').textContent = '‚ûï Add New Module';
            document.getElementById('moduleTitle').value = '';
            document.getElementById('moduleIcon').value = 'üéì';
            document.getElementById('moduleDescription').value = '';
            document.getElementById('deleteModuleBtn').style.display = 'none';
            
            document.getElementById('chaptersList').innerHTML = '';
            document.getElementById('moduleEditorModal').classList.remove('hidden');
        }

        function editModule(index) {
            currentEditingModuleIndex = index;
            const module = trainingModules[index];
            
            document.getElementById('moduleEditorTitle').textContent = '‚úèÔ∏è Edit Module';
            document.getElementById('moduleTitle').value = module.title;
            document.getElementById('moduleIcon').value = module.icon;
            document.getElementById('moduleDescription').value = module.description;
            document.getElementById('deleteModuleBtn').style.display = 'inline-block';
            
            renderChaptersList(module.chapters);
            document.getElementById('moduleEditorModal').classList.remove('hidden');
        }

        function removeModule(index) {
            showCustomConfirm(`Are you sure you want to delete "${trainingModules[index].title}"?`, (confirmed) => {
                if (confirmed) {
                    trainingModules.splice(index, 1);
                    // Reassign IDs
                    trainingModules.forEach((module, i) => {
                        module.id = i + 1;
                    });
                    renderModulesList();
                    showNotification('üóëÔ∏è Module deleted successfully!', 'success');
                }
            });
        }

        function saveModule() {
            const title = document.getElementById('moduleTitle').value.trim();
            const icon = document.getElementById('moduleIcon').value.trim();
            const description = document.getElementById('moduleDescription').value.trim();
            
            if (!title || !icon || !description) {
                showNotification('Please fill in all fields', 'warning');
                return;
            }
            
            const moduleData = {
                title: title,
                icon: icon,
                description: description,
                chapters: currentEditingModuleIndex >= 0 ? trainingModules[currentEditingModuleIndex].chapters : []
            };
            
            if (currentEditingModuleIndex >= 0) {
                // Editing existing module
                moduleData.id = trainingModules[currentEditingModuleIndex].id;
                trainingModules[currentEditingModuleIndex] = moduleData;
                showNotification('üíæ Module updated successfully!', 'success');
            } else {
                // Adding new module
                moduleData.id = trainingModules.length + 1;
                trainingModules.push(moduleData);
                showNotification('‚ûï New module added successfully!', 'success');
            }
            
            closeModuleEditor();
            renderModulesList();
        }

        function deleteModule() {
            if (currentEditingModuleIndex >= 0) {
                showCustomConfirm(`Are you sure you want to delete "${trainingModules[currentEditingModuleIndex].title}"?`, (confirmed) => {
                    if (confirmed) {
                        trainingModules.splice(currentEditingModuleIndex, 1);
                        // Reassign IDs
                        trainingModules.forEach((module, i) => {
                            module.id = i + 1;
                        });
                        closeModuleEditor();
                        renderModulesList();
                        showNotification('üóëÔ∏è Module deleted successfully!', 'success');
                    }
                });
            }
        }

        function closeModuleEditor() {
            document.getElementById('moduleEditorModal').classList.add('hidden');
        }

        // Chapter Management Functions
        function renderChaptersList(chapters) {
            const container = document.getElementById('chaptersList');
            if (!container) return;
            
            container.innerHTML = '';
            
            chapters.forEach((chapter, index) => {
                const chapterDiv = document.createElement('div');
                chapterDiv.className = 'chapter-list-item';
                chapterDiv.style.cssText = 'background: var(--sophisticated-gray); border: 1px solid var(--border-color); border-radius: var(--border-radius-sm); padding: 15px; margin: 10px 0; display: flex; justify-content: space-between; align-items: center;';
                chapterDiv.innerHTML = `
                    <div>
                        <h4 style="margin: 0; color: var(--ess-green);">${chapter.title}</h4>
                        <small style="color: var(--text-light);">${chapter.quizzes.length} quizzes</small>
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-small btn-info" onclick="editChapter(${index})">‚úèÔ∏è Edit</button>
                        <button class="btn btn-small btn-danger" onclick="removeChapter(${index})">üóëÔ∏è Delete</button>
                    </div>
                `;
                container.appendChild(chapterDiv);
            });
        }

        function addNewChapter() {
            currentEditingChapterIndex = -1;
            document.getElementById('chapterEditorTitle').textContent = '‚ûï Add New Chapter';
            document.getElementById('chapterTitle').value = '';
            document.getElementById('chapterContent').value = '';
            document.getElementById('deleteChapterBtn').style.display = 'none';
            
            document.getElementById('quizzesList').innerHTML = '';
            document.getElementById('chapterEditorModal').classList.remove('hidden');
        }

        function editChapter(index) {
            currentEditingChapterIndex = index;
            const module = trainingModules[currentEditingModuleIndex];
            const chapter = module.chapters[index];
            
            document.getElementById('chapterEditorTitle').textContent = '‚úèÔ∏è Edit Chapter';
            document.getElementById('chapterTitle').value = chapter.title;
            document.getElementById('chapterContent').value = chapter.content;
            document.getElementById('deleteChapterBtn').style.display = 'inline-block';
            
            renderQuizzesList(chapter.quizzes);
            document.getElementById('chapterEditorModal').classList.remove('hidden');
        }

        function removeChapter(index) {
            const module = trainingModules[currentEditingModuleIndex];
            showCustomConfirm(`Are you sure you want to delete "${module.chapters[index].title}"?`, (confirmed) => {
                if (confirmed) {
                    module.chapters.splice(index, 1);
                    renderChaptersList(module.chapters);
                    showNotification('üóëÔ∏è Chapter deleted successfully!', 'success');
                }
            });
        }

        function saveChapter() {
            const title = document.getElementById('chapterTitle').value.trim();
            const content = document.getElementById('chapterContent').value.trim();
            
            if (!title || !content) {
                showNotification('Please fill in all fields', 'warning');
                return;
            }
            
            const chapterData = {
                title: title,
                content: content,
                quizzes: currentEditingChapterIndex >= 0 ? trainingModules[currentEditingModuleIndex].chapters[currentEditingChapterIndex].quizzes : []
            };
            
            if (currentEditingModuleIndex >= 0) {
                if (currentEditingChapterIndex >= 0) {
                    // Editing existing chapter
                    trainingModules[currentEditingModuleIndex].chapters[currentEditingChapterIndex] = chapterData;
                    showNotification('üíæ Chapter updated successfully!', 'success');
                } else {
                    // Adding new chapter
                    trainingModules[currentEditingModuleIndex].chapters.push(chapterData);
                    showNotification('‚ûï New chapter added successfully!', 'success');
                }
            }
            
            closeChapterEditor();
            renderChaptersList(trainingModules[currentEditingModuleIndex].chapters);
        }

        function deleteChapter() {
            if (currentEditingChapterIndex >= 0) {
                const module = trainingModules[currentEditingModuleIndex];
                showCustomConfirm(`Are you sure you want to delete "${module.chapters[currentEditingChapterIndex].title}"?`, (confirmed) => {
                    if (confirmed) {
                        module.chapters.splice(currentEditingChapterIndex, 1);
                        closeChapterEditor();
                        renderChaptersList(module.chapters);
                        showNotification('üóëÔ∏è Chapter deleted successfully!', 'success');
                    }
                });
            }
        }

        function closeChapterEditor() {
            document.getElementById('chapterEditorModal').classList.add('hidden');
        }

        // Content Formatting Functions
        function formatText(command) {
            const textarea = document.getElementById('chapterContent');
            const start = textarea.selectionStart;
            const end = textarea.selectionEnd;
            const selectedText = textarea.value.substring(start, end);
            
            let formattedText = selectedText;
            switch(command) {
                case 'bold':
                    formattedText = `<strong>${selectedText}</strong>`;
                    break;
                case 'italic':
                    formattedText = `<em>${selectedText}</em>`;
                    break;
                case 'underline':
                    formattedText = `<u>${selectedText}</u>`;
                    break;
            }
            
            textarea.value = textarea.value.substring(0, start) + formattedText + textarea.value.substring(end);
            textarea.focus();
        }

        function insertKeyPoint() {
            const textarea = document.getElementById('chapterContent');
            const keyPoint = `
                            <div class="key-point">
                                <strong>üéØ Key Point:</strong> Enter your key point here
                            </div>
                        `;
            insertAtCursor(textarea, keyPoint);
        }

        function insertTipBox() {
            const textarea = document.getElementById('chapterContent');
            const tipBox = `
                            <div class="tip-box">
                                <strong>üí° Tip:</strong> Enter your tip here
                            </div>
                        `;
            insertAtCursor(textarea, tipBox);
        }

        function insertWarning() {
            const textarea = document.getElementById('chapterContent');
            const warning = `
                            <div class="warning-box">
                                <strong>‚ö†Ô∏è Warning:</strong> Enter your warning here
                            </div>
                        `;
            insertAtCursor(textarea, warning);
        }

        function insertAtCursor(textarea, text) {
            const start = textarea.selectionStart;
            const end = textarea.selectionEnd;
            textarea.value = textarea.value.substring(0, start) + text + textarea.value.substring(end);
            textarea.focus();
        }

        // Quiz Management Functions
        function renderQuizzesList(quizzes) {
            const container = document.getElementById('quizzesList');
            if (!container) return;
            
            container.innerHTML = '';
            
            quizzes.forEach((quiz, index) => {
                const quizDiv = document.createElement('div');
                quizDiv.className = 'quiz-editor';
                quizDiv.style.cssText = 'border: 2px solid var(--border-color); border-radius: var(--border-radius-sm); padding: 25px; margin: 20px 0; background: var(--sophisticated-gray); transition: var(--transition);';
                quizDiv.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h4 style="color: var(--ess-green);">Quiz ${index + 1}</h4>
                        <button class="btn btn-small btn-danger" onclick="removeQuiz(${index})">üóëÔ∏è Remove</button>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Question</label>
                        <input type="text" class="form-input quiz-question-input" value="${quiz.question}" data-index="${index}">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Answer Options</label>
                        ${quiz.options.map((option, optIndex) => `
                            <div style="display: flex; align-items: center; gap: 10px; margin: 10px 0;">
                                <input type="radio" name="correct_${index}" value="${optIndex}" ${quiz.correct === optIndex ? 'checked' : ''}>
                                <input type="text" class="form-input quiz-option-input" value="${option}" data-quiz="${index}" data-option="${optIndex}" style="flex: 1;">
                                <label style="margin: 0;">Correct</label>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Points</label>
                        <input type="number" class="form-input quiz-points-input" value="${quiz.points}" min="1" max="50" data-index="${index}">
                    </div>
                `;
                container.appendChild(quizDiv);
            });
        }

        function addNewQuiz() {
            const moduleIndex = currentEditingModuleIndex;
            const chapterIndex = currentEditingChapterIndex;
            
            if (moduleIndex < 0) {
                showNotification('Please save the module first', 'warning');
                return;
            }
            
            const newQuiz = {
                question: "Enter your question here",
                options: [
                    "Option A",
                    "Option B", 
                    "Option C",
                    "Option D"
                ],
                correct: 0,
                points: 10
            };
            
            // Add to temporary chapter data or existing chapter
            if (chapterIndex >= 0) {
                trainingModules[moduleIndex].chapters[chapterIndex].quizzes.push(newQuiz);
                renderQuizzesList(trainingModules[moduleIndex].chapters[chapterIndex].quizzes);
            } else {
                // This is a new chapter, add to temporary quiz list
                if (!window.tempQuizzes) window.tempQuizzes = [];
                window.tempQuizzes.push(newQuiz);
                renderQuizzesList(window.tempQuizzes);
            }
            
            showNotification('‚ûï New quiz added!', 'success');
        }

        function removeQuiz(index) {
            showCustomConfirm('Are you sure you want to remove this quiz?', (confirmed) => {
                if (confirmed) {
                    const moduleIndex = currentEditingModuleIndex;
                    const chapterIndex = currentEditingChapterIndex;
                    
                    if (chapterIndex >= 0) {
                        trainingModules[moduleIndex].chapters[chapterIndex].quizzes.splice(index, 1);
                        renderQuizzesList(trainingModules[moduleIndex].chapters[chapterIndex].quizzes);
                    } else {
                        if (window.tempQuizzes) {
                            window.tempQuizzes.splice(index, 1);
                            renderQuizzesList(window.tempQuizzes);
                        }
                    }
                    showNotification('üóëÔ∏è Quiz removed!', 'success');
                }
            });
        }

        // Design Editor Functions
        function loadDesignEditor() {
            // Load current design values
            document.getElementById('primaryColor').value = designSettings.colors.primary;
            document.getElementById('secondaryColor').value = designSettings.colors.secondary;
            document.getElementById('accentColor').value = designSettings.colors.accent;
            
            // Load company info
            document.getElementById('companyTitleEdit').value = designSettings.typography.companyTitle;
            document.getElementById('companySubtitleEdit').value = designSettings.typography.companySubtitle;
            
            // Load other settings
            document.getElementById('fontFamily').value = designSettings.typography.fontFamily;
            document.getElementById('backgroundStyle').value = designSettings.layout.backgroundStyle;
            document.getElementById('borderRadius').value = designSettings.layout.borderRadius;
            document.getElementById('borderRadiusValue').textContent = designSettings.layout.borderRadius + 'px';
            document.getElementById('shadowStyle').value = designSettings.layout.shadowStyle;
            document.getElementById('transitionSpeed').value = designSettings.layout.transitionSpeed;
            document.getElementById('goldAccents').checked = designSettings.layout.goldAccents;
            document.getElementById('winkyAnimations').checked = designSettings.layout.winkyAnimations;
            document.getElementById('winkyFrequency').value = designSettings.layout.winkyFrequency;
            document.getElementById('winkyExpression').checked = designSettings.layout.winkyExpressions;
        }

        function updateColors() {
            const primaryColor = document.getElementById('primaryColor').value;
            const secondaryColor = document.getElementById('secondaryColor').value;
            const accentColor = document.getElementById('accentColor').value;
            
            document.documentElement.style.setProperty('--ess-green', primaryColor);
            document.documentElement.style.setProperty('--artisanal-green', secondaryColor);
            document.documentElement.style.setProperty('--golden-crust', accentColor);
            
            designSettings.colors.primary = primaryColor;
            designSettings.colors.secondary = secondaryColor;
            designSettings.colors.accent = accentColor;
        }

        function updateBackground() {
            const style = document.getElementById('backgroundStyle').value;
            const body = document.body;
            
            switch(style) {
                case 'gradient':
                    body.style.background = 'linear-gradient(135deg, var(--cream-white) 0%, var(--sophisticated-gray) 100%)';
                    break;
                case 'solid':
                    body.style.background = 'var(--cream-white)';
                    break;
                case 'pattern':
                    body.style.background = 'radial-gradient(circle at 20% 80%, rgba(255, 214, 135, 0.1) 0%, transparent 50%), radial-gradient(circle at 80% 20%, rgba(255, 171, 127, 0.1) 0%, transparent 50%) var(--cream-white)';
                    break;
            }
            
            designSettings.layout.backgroundStyle = style;
        }

        function updateFont() {
            const fontFamily = document.getElementById('fontFamily').value;
            let fontValue;
            
            switch(fontFamily) {
                case 'libre':
                    fontValue = "'Libre Franklin', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif";
                    break;
                case 'cormorant':
                    fontValue = "'Cormorant Garamond', 'EB Garamond', serif";
                    break;
                case 'eb':
                    fontValue = "'EB Garamond', 'Cormorant Garamond', serif";
                    break;
                case 'system':
                    fontValue = '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
                    break;
                default:
                    fontValue = "'Libre Franklin', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif";
            }
            
            document.documentElement.style.setProperty('--font-family', fontValue);
            designSettings.typography.fontFamily = fontFamily;
        }

        function updateCompanyInfo() {
            const title = document.getElementById('companyTitleEdit').value;
            const subtitle = document.getElementById('companySubtitleEdit').value;
            
            document.getElementById('companyTitle').textContent = title;
            document.getElementById('companySubtitle').textContent = subtitle;
            
            designSettings.typography.companyTitle = title;
            designSettings.typography.companySubtitle = subtitle;
        }

        function updateBorderRadius() {
            const radius = document.getElementById('borderRadius').value;
            document.getElementById('borderRadiusValue').textContent = radius + 'px';
            document.documentElement.style.setProperty('--border-radius', radius + 'px');
            document.documentElement.style.setProperty('--border-radius-sm', (radius * 0.75) + 'px');
            
            designSettings.layout.borderRadius = radius;
        }

        function updateShadow() {
            const style = document.getElementById('shadowStyle').value;
            let shadowValue;
            
            switch(style) {
                case 'light':
                    shadowValue = '0 2px 8px rgba(8, 57, 21, 0.05)';
                    break;
                case 'normal':
                    shadowValue = '0 4px 20px rgba(8, 57, 21, 0.1)';
                    break;
                case 'heavy':
                    shadowValue = '0 8px 40px rgba(8, 57, 21, 0.2)';
                    break;
                case 'none':
                    shadowValue = 'none';
                    break;
            }
            
            document.documentElement.style.setProperty('--shadow', shadowValue);
            designSettings.layout.shadowStyle = style;
        }

        function updateTransitions() {
            const speed = document.getElementById('transitionSpeed').value;
            let transitionValue;
            
            switch(speed) {
                case 'slow':
                    transitionValue = 'all 0.5s cubic-bezier(0.4, 0, 0.2, 1)';
                    break;
                case 'normal':
                    transitionValue = 'all 0.3s cubic-bezier(0.4, 0, 0.2, 1)';
                    break;
                case 'fast':
                    transitionValue = 'all 0.2s cubic-bezier(0.4, 0, 0.2, 1)';
                    break;
                case 'instant':
                    transitionValue = 'none';
                    break;
            }
            
            document.documentElement.style.setProperty('--transition', transitionValue);
            designSettings.layout.transitionSpeed = speed;
        }

        function updateGoldAccents() {
            const enabled = document.getElementById('goldAccents').checked;
            designSettings.layout.goldAccents = enabled;
            
            if (enabled) {
                document.documentElement.style.setProperty('--gold', 'linear-gradient(135deg, #FFD687 0%, #FFA490 50%, #FFAB7F 100%)');
            } else {
                document.documentElement.style.setProperty('--gold', 'var(--ess-green)');
            }
            
            showNotification(`‚ú® Gold accents ${enabled ? 'enabled' : 'disabled'}!`, 'info');
        }

        function updateWinkyAnimations() {
            const enabled = document.getElementById('winkyAnimations').checked;
            designSettings.layout.winkyAnimations = enabled;
            showNotification(`üòâ Winky animations ${enabled ? 'enabled' : 'disabled'}!`, 'info');
        }

        function updateWinkyFrequency() {
            const frequency = document.getElementById('winkyFrequency').value;
            designSettings.layout.winkyFrequency = frequency;
            showNotification(`üòâ Winky frequency set to ${frequency}!`, 'info');
        }

        function updateWinkyExpressions() {
            const enabled = document.getElementById('winkyExpression').checked;
            designSettings.layout.winkyExpressions = enabled;
            showNotification(`üòä Dynamic expressions ${enabled ? 'enabled' : 'disabled'}!`, 'info');
        }

        function saveDesign() {
            showNotification('üíæ Ess-a-Bagel design saved successfully!', 'success');
        }

        function resetDesign() {
            showCustomConfirm('Reset to authentic Ess-a-Bagel brand standards?', (confirmed) => {
                if (confirmed) {
                    designSettings = {
                        colors: {
                            primary: "#083915",
                            secondary: "#062B0F",
                            accent: "#FFD687"
                        },
                        typography: {
                            fontFamily: "libre",
                            companyTitle: "Ess-a-Bagel Training Academy",
                            companySubtitle: "Master the Art of Authentic New York Bagels"
                        },
                        layout: {
                            backgroundStyle: "gradient",
                            borderRadius: "16",
                            shadowStyle: "normal",
                            transitionSpeed: "normal",
                            goldAccents: true,
                            winkyAnimations: true,
                            winkyFrequency: "normal",
                            winkyExpressions: true
                        }
                    };
                    location.reload();
                }
            });
        }

        function previewDesign() {
            showNotification('üëÅÔ∏è Preview updated! Check how your design looks!', 'info');
        }

        function loadSavedDesign() {
            // Apply saved design settings from internal storage
            if (designSettings) {
                // Apply colors
                if (designSettings.colors) {
                    document.documentElement.style.setProperty('--ess-green', designSettings.colors.primary);
                    document.documentElement.style.setProperty('--artisanal-green', designSettings.colors.secondary);
                    document.documentElement.style.setProperty('--golden-crust', designSettings.colors.accent);
                }
                
                // Apply typography
                if (designSettings.typography) {
                    if (designSettings.typography.companyTitle) {
                        document.getElementById('companyTitle').textContent = designSettings.typography.companyTitle;
                    }
                    if (designSettings.typography.companySubtitle) {
                        document.getElementById('companySubtitle').textContent = designSettings.typography.companySubtitle;
                    }
                }
            }
        }

        // Template Functions
        function loadTemplate(templateName) {
            showCustomConfirm(`Load the ${templateName} template? This will replace current content.`, (confirmed) => {
                if (confirmed) {
                    switch(templateName) {
                        case 'essabagel':
                            showNotification('ü•Ø Ess-a-Bagel template is already loaded!', 'info');
                            break;
                        case 'restaurant':
                            loadRestaurantTemplate();
                            break;
                        case 'retail':
                            loadRetailTemplate();
                            break;
                        case 'blank':
                            loadBlankTemplate();
                            break;
                    }
                    showNotification(`üìã ${templateName} template loaded!`, 'success');
                    renderModulesList();
                }
            });
        }

        function loadRestaurantTemplate() {
            trainingModules = [
                {
                    id: 1,
                    title: "Restaurant Fundamentals",
                    icon: "üçΩÔ∏è",
                    description: "Master the basics of restaurant operations",
                    chapters: [
                        {
                            title: "Food Safety Basics",
                            content: `<h3>Food Safety Guidelines</h3><p>Learn essential food safety protocols...</p>`,
                            quizzes: [{
                                question: "What is the minimum safe cooking temperature for poultry?",
                                options: ["145¬∞F", "160¬∞F", "165¬∞F", "180¬∞F"],
                                correct: 2,
                                points: 15
                            }]
                        }
                    ]
                }
            ];
        }

        function loadRetailTemplate() {
            trainingModules = [
                {
                    id: 1,
                    title: "Retail Essentials",
                    icon: "üõçÔ∏è",
                    description: "Master retail operations",
                    chapters: [
                        {
                            title: "Customer Service",
                            content: `<h3>Excellent Customer Service</h3><p>Learn to provide outstanding customer experiences...</p>`,
                            quizzes: [{
                                question: "What is the most important aspect of customer service?",
                                options: ["Speed", "Friendliness", "Product knowledge", "All of the above"],
                                correct: 3,
                                points: 10
                            }]
                        }
                    ]
                }
            ];
        }

        function loadBlankTemplate() {
            trainingModules = [
                {
                    id: 1,
                    title: "Sample Module",
                    icon: "üìö",
                    description: "Replace with your custom content",
                    chapters: [
                        {
                            title: "Sample Chapter",
                            content: `<h3>Welcome</h3><p>Replace this content with your own training materials.</p>`,
                            quizzes: [{
                                question: "This is a sample question",
                                options: ["Option 1", "Option 2", "Option 3", "Option 4"],
                                correct: 0,
                                points: 10
                            }]
                        }
                    ]
                }
            ];
        }

        // Additional admin functions (simplified for space)
        function exportContent() {
            const contentData = {
                modules: trainingModules,
                timestamp: new Date().toISOString(),
                version: '1.0'
            };
            downloadJSON(contentData, `ess-a-bagel-content-${new Date().toISOString().split('T')[0]}.json`);
            showNotification('üì§ Content exported!', 'success');
        }

        function importContent() {
            showNotification('üì• Import feature coming soon!', 'info');
        }

        function reorderModules() {
            showNotification('üîÑ Drag and drop reordering coming soon!', 'info');
        }

        function downloadJSON(data, filename) {
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            window.URL.revokeObjectURL(url);
        }

        // Utility Functions
        function copyToClipboard(text, message) {
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(text).then(() => {
                    showNotification(message, 'success');
                }).catch(() => {
                    fallbackCopy(text, message);
                });
            } else {
                fallbackCopy(text, message);
            }
        }

        function fallbackCopy(text, message) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            document.body.appendChild(textArea);
            textArea.select();
            
            try {
                document.execCommand('copy');
                showNotification(message, 'success');
            } catch (err) {
                showNotification('Copy failed - please manually copy', 'warning');
            }
            
            document.body.removeChild(textArea);
        }

        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = 'notification ' + type;
            notification.innerHTML = `<span class="winky" style="margin-right: 10px; font-size: 1.2rem;"></span>${message}`;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.add('show');
            }, 100);
            
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
            }, 4000);
        }

        function showCustomConfirm(message, callback) {
            document.getElementById('confirmMessage').textContent = message;
            document.getElementById('customConfirm').classList.remove('hidden');
            pendingConfirmCallback = callback;
        }

        function confirmAction(confirmed) {
            document.getElementById('customConfirm').classList.add('hidden');
            if (pendingConfirmCallback) {
                pendingConfirmCallback(confirmed);
                pendingConfirmCallback = null;
            }
        }

        // Sharing System Functions (SafetyCulture-Inspired Professional Features)
        function showEmailInvite() {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.innerHTML = `
                <div class="modal-content modal-content-large">
                    <div style="display: flex; align-items: center; margin-bottom: 30px;">
                        <span class="winky excited" style="font-size: 3rem; margin-right: 20px;"></span>
                        <h2 style="color: var(--ess-green); font-family: var(--heading-font);">üìß Send Training Invitations</h2>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">üì§ Email Template</label>
                        <select id="emailTemplate" class="form-input" onchange="updateEmailTemplate()">
                            <option value="welcome">Welcome & Getting Started</option>
                            <option value="reminder">Training Reminder</option>
                            <option value="completion">Completion Certificate</option>
                            <option value="custom">Custom Message</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">üìß Recipient Emails (one per line)</label>
                        <textarea id="recipientEmails" class="form-input" rows="5" placeholder="john.doe@essabagel.com&#10;jane.smith@essabagel.com&#10;team@essabagel.com"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">üìù Subject Line</label>
                        <input type="text" id="emailSubject" class="form-input" value="ü•Ø Welcome to Ess-a-Bagel Training Academy!">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">‚úâÔ∏è Message Body</label>
                        <textarea id="emailBody" class="form-input" rows="8" style="resize: vertical;"></textarea>
                    </div>
                    
                    <div style="background: var(--sophisticated-gray); padding: 20px; border-radius: var(--border-radius-sm); margin: 20px 0;">
                        <h4 style="color: var(--ess-green); margin-bottom: 15px;">üì± Email Variables Available:</h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; font-family: monospace; font-size: 14px;">
                            <div>{{employee_name}}</div>
                            <div>{{training_url}}</div>
                            <div>{{company_name}}</div>
                            <div>{{current_date}}</div>
                            <div>{{manager_name}}</div>
                            <div>{{completion_deadline}}</div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 30px; text-align: center;">
                        <button class="btn btn-gold btn-large" onclick="sendTrainingEmails()">üì§ Send Invitations</button>
                        <button class="btn btn-info" onclick="previewEmail()">üëÅÔ∏è Preview</button>
                        <button class="btn btn-secondary" onclick="this.closest('.modal').remove()">‚ùå Cancel</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            updateEmailTemplate();
        }

        function updateEmailTemplate() {
            const template = document.getElementById('emailTemplate').value;
            const currentURL = window.location.href;
            
            const templates = {
                welcome: {
                    subject: "ü•Ø Welcome to Ess-a-Bagel Training Academy!",
                    body: `Dear {{employee_name}},

Welcome to the Ess-a-Bagel family! We're excited to have you join our team and begin your journey to mastering the art of authentic New York bagels.

üéì Your personalized training portal is ready:
{{training_url}}

What you'll learn:
‚Ä¢ Our mission: "To bestow the world with the finest New York-style bagels made with love"
‚Ä¢ Five core values that define our heritage
‚Ä¢ The famous 10-second customer service rule
‚Ä¢ Proper food safety and sanitation
‚Ä¢ Toast POS system mastery

‚ú® Training Features:
‚Ä¢ Interactive lessons with Winky, our friendly mascot
‚Ä¢ Progress tracking and achievement points
‚Ä¢ Mobile-friendly access anywhere, anytime
‚Ä¢ Immediate certificates upon completion

Please complete your training by {{completion_deadline}}. If you have any questions, don't hesitate to reach out!

Best regards,
{{manager_name}}
{{company_name}}

"To bestow the world with the finest New York-style bagels made with love" ü•Ø`
                },
                reminder: {
                    subject: "‚è∞ Training Reminder - Ess-a-Bagel Academy",
                    body: `Hi {{employee_name}},

This is a friendly reminder about your Ess-a-Bagel training that's due {{completion_deadline}}.

üéØ Quick Access: {{training_url}}

Your current progress shows you're making great strides! Complete your training to earn your official Ess-a-Bagel certification and join our team of bagel experts.

Need help? We're here to support you!

{{manager_name}}
{{company_name}}`
                },
                completion: {
                    subject: "üèÜ Congratulations! Training Complete - Ess-a-Bagel",
                    body: `Congratulations {{employee_name}}!

üéâ You've successfully completed your Ess-a-Bagel Training Academy program! You're now officially certified in our standards of excellence.

Your achievements:
‚Ä¢ ‚úÖ All modules completed
‚Ä¢ üèÜ Certification earned
‚Ä¢ ü•Ø Ready to serve authentic NY bagels

View your certificate: {{training_url}}

Welcome to the team! We're excited to see you put your new skills to work.

With bagel pride,
{{manager_name}}
{{company_name}}`
                },
                custom: {
                    subject: "ü•Ø Ess-a-Bagel Training Update",
                    body: `Dear {{employee_name}},

[Write your custom message here]

Training Link: {{training_url}}

Best regards,
{{manager_name}}
{{company_name}}`
                }
            };
            
            const selectedTemplate = templates[template];
            document.getElementById('emailSubject').value = selectedTemplate.subject;
            document.getElementById('emailBody').value = selectedTemplate.body;
        }

        function sendTrainingEmails() {
            const emails = document.getElementById('recipientEmails').value.split('\n').filter(email => email.trim());
            const subject = document.getElementById('emailSubject').value;
            const body = document.getElementById('emailBody').value;
            
            if (emails.length === 0) {
                showNotification('Please enter at least one email address', 'warning');
                return;
            }
            
            // Simulate sending emails (in real implementation, this would call your email service)
            emails.forEach(email => {
                const personalizedBody = body
                    .replace(/{{employee_name}}/g, email.split('@')[0].replace(/[._]/g, ' '))
                    .replace(/{{training_url}}/g, window.location.href)
                    .replace(/{{company_name}}/g, 'Ess-a-Bagel')
                    .replace(/{{current_date}}/g, new Date().toLocaleDateString())
                    .replace(/{{manager_name}}/g, currentEmployee?.name || 'Training Manager')
                    .replace(/{{completion_deadline}}/g, new Date(Date.now() + 14 * 24 * 60 * 60 * 1000).toLocaleDateString());
                
                // In real implementation: emailService.send(email, subject, personalizedBody)
                console.log(`Sending email to ${email}:`, { subject, body: personalizedBody });
            });
            
            event.target.closest('.modal').remove();
            showNotification(`üìß ${emails.length} training invitations sent successfully!`, 'success');
        }

        function previewEmail() {
            const template = document.getElementById('emailTemplate').value;
            const subject = document.getElementById('emailSubject').value;
            const body = document.getElementById('emailBody').value;
            
            const previewWindow = window.open('', '_blank', 'width=800,height=600');
            previewWindow.document.write(`
                <html>
                <head>
                    <title>Email Preview</title>
                    <style>
                        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
                        .email-container { background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
                        .header { background: #083915; color: white; padding: 20px; text-align: center; border-radius: 8px 8px 0 0; }
                        .content { padding: 20px; line-height: 1.6; }
                        .footer { background: #f8f9fa; padding: 15px; text-align: center; border-radius: 0 0 8px 8px; }
                    </style>
                </head>
                <body>
                    <div class="email-container">
                        <div class="header">
                            <h2>üìß ${subject}</h2>
                        </div>
                        <div class="content">
                            <pre style="white-space: pre-wrap; font-family: inherit;">${body}</pre>
                        </div>
                        <div class="footer">
                            <small>This is a preview of your training invitation email</small>
                        </div>
                    </div>
                </body>
                </html>
            `);
        }

        function generateQR() {
            const currentURL = window.location.href;
            
            // Simple QR code generation (in production, use a proper QR library)
            const qrModal = document.createElement('div');
            qrModal.className = 'modal';
            qrModal.innerHTML = `
                <div class="modal-content">
                    <div style="display: flex; align-items: center; justify-content: center; margin-bottom: 30px;">
                        <span class="winky excited" style="font-size: 3rem; margin-right: 20px;"></span>
                        <h2 style="color: var(--ess-green); font-family: var(--heading-font);">üì± QR Code Access</h2>
                    </div>
                    
                    <div style="text-align: center; margin: 30px 0;">
                        <div style="background: white; padding: 20px; border-radius: var(--border-radius); display: inline-block; box-shadow: var(--shadow);">
                            <div style="width: 200px; height: 200px; background: #000; color: white; display: flex; align-items: center; justify-content: center; font-size: 12px; text-align: center; line-height: 1.2;">
                                ü•Ø QR CODE<br>Scan to Access<br>Training Portal<br><small>${currentURL.slice(0, 30)}...</small>
                            </div>
                        </div>
                        <p style="margin-top: 20px; color: var(--text-light);">Scan with any QR code reader to access training</p>
                    </div>
                    
                    <div style="background: var(--sophisticated-gray); padding: 20px; border-radius: var(--border-radius-sm); margin: 20px 0;">
                        <h4 style="color: var(--ess-green); margin-bottom: 15px;">üì± Instructions for Employees:</h4>
                        <ol style="text-align: left;">
                            <li>Open your phone's camera or QR scanner app</li>
                            <li>Point camera at the QR code above</li>
                            <li>Tap the notification that appears</li>
                            <li>Enter your Employee ID and start training!</li>
                        </ol>
                    </div>
                    
                    <div style="margin-top: 30px; text-align: center;">
                        <button class="btn btn-gold" onclick="downloadQR()">üì• Download QR Code</button>
                        <button class="btn btn-info" onclick="printQR()">üñ®Ô∏è Print QR Code</button>
                        <button class="btn btn-secondary" onclick="this.closest('.modal').remove()">‚ùå Close</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(qrModal);
        }

        function downloadQR() {
            // In production, generate actual QR code image
            showNotification('üì• QR code download feature coming soon!', 'info');
        }

        function printQR() {
            window.print();
        }

        function copyTrainingURL() {
            const currentURL = window.location.href;
            copyToClipboard(currentURL, 'üîó Training URL copied to clipboard!');
        }

        function copyCurrentURL() {
            const currentURL = window.location.href;
            copyToClipboard(currentURL, 'üìã URL copied successfully!');
        }

        function previewTraining() {
            window.open(window.location.href, '_blank');
        }

        function testEmail() {
            const testModal = document.createElement('div');
            testModal.className = 'modal';
            testModal.innerHTML = `
                <div class="modal-content">
                    <div style="display: flex; align-items: center; justify-content: center; margin-bottom: 30px;">
                        <span class="winky thinking" style="font-size: 3rem; margin-right: 20px;"></span>
                        <h2 style="color: var(--ess-green); font-family: var(--heading-font);">üìß Test Email</h2>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Test Email Address</label>
                        <input type="email" id="testEmailAddress" class="form-input" placeholder="manager@essabagel.com">
                    </div>
                    
                    <div style="margin-top: 30px; text-align: center;">
                        <button class="btn btn-warning" onclick="sendTestEmail()">üìß Send Test</button>
                        <button class="btn btn-secondary" onclick="this.closest('.modal').remove()">‚ùå Cancel</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(testModal);
        }

        function sendTestEmail() {
            const email = document.getElementById('testEmailAddress').value;
            if (!email) {
                showNotification('Please enter an email address', 'warning');
                return;
            }
            
            // Simulate sending test email
            console.log(`Sending test email to ${email}`);
            event.target.closest('.modal').remove();
            showNotification('üìß Test email sent successfully!', 'success');
        }

        function downloadSystem() {
            const systemData = {
                trainingModules: trainingModules,
                employeeDatabase: employeeDatabase,
                adaptiveData: adaptiveData,
                designSettings: designSettings,
                systemSettings: systemSettings,
                timestamp: new Date().toISOString(),
                version: '2.0'
            };
            
            downloadJSON(systemData, `ess-a-bagel-training-system-${new Date().toISOString().split('T')[0]}.json`);
            showNotification('üíæ Complete training system downloaded!', 'success');
        }

        function showBulkInvite() {
            const bulkModal = document.createElement('div');
            bulkModal.className = 'modal';
            bulkModal.innerHTML = `
                <div class="modal-content modal-content-large">
                    <div style="display: flex; align-items: center; margin-bottom: 30px;">
                        <span class="winky celebrating" style="font-size: 3rem; margin-right: 20px;"></span>
                        <h2 style="color: var(--ess-green); font-family: var(--heading-font);">üì¨ Bulk Email Invitations</h2>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                        <div>
                            <h4 style="color: var(--ess-green); margin-bottom: 15px;">üìã Employee Import</h4>
                            <div class="form-group">
                                <label class="form-label">Upload CSV File</label>
                                <input type="file" id="csvFile" class="form-input" accept=".csv" onchange="previewCSV()">
                                <small style="color: var(--text-light); display: block; margin-top: 5px;">Format: Name, Email, Department</small>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Or Paste CSV Data</label>
                                <textarea id="csvData" class="form-input" rows="8" placeholder="John Doe,john@essabagel.com,Cashier&#10;Jane Smith,jane@essabagel.com,Kitchen"></textarea>
                            </div>
                        </div>
                        
                        <div>
                            <h4 style="color: var(--ess-green); margin-bottom: 15px;">üë• Departments</h4>
                            <div style="background: var(--sophisticated-gray); padding: 20px; border-radius: var(--border-radius-sm);">
                                <label><input type="checkbox" checked> Cashier/Counter Service</label><br>
                                <label><input type="checkbox" checked> Kitchen & Food Prep</label><br>
                                <label><input type="checkbox" checked> Management</label><br>
                                <label><input type="checkbox" checked> Bakery Production</label><br>
                                <label><input type="checkbox" checked> Catering</label><br>
                                <label><input type="checkbox" checked> Maintenance</label><br>
                            </div>
                            
                            <div style="margin-top: 20px;">
                                <h4 style="color: var(--ess-green); margin-bottom: 15px;">‚öôÔ∏è Email Settings</h4>
                                <div class="form-group">
                                    <label class="form-label">Completion Deadline</label>
                                    <input type="date" id="deadline" class="form-input" value="${new Date(Date.now() + 14 * 24 * 60 * 60 * 1000).toISOString().split('T')[0]}">
                                </div>
                                <div class="form-group">
                                    <label><input type="checkbox" checked> Send welcome email</label><br>
                                    <label><input type="checkbox"> Schedule reminder emails</label><br>
                                    <label><input type="checkbox"> Auto-generate employee IDs</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="previewTable" style="margin-top: 30px;"></div>
                    
                    <div style="margin-top: 30px; text-align: center;">
                        <button class="btn btn-gold btn-large" onclick="processBulkInvites()">üì¨ Send Bulk Invitations</button>
                        <button class="btn btn-info" onclick="downloadTemplate()">üìã Download CSV Template</button>
                        <button class="btn btn-secondary" onclick="this.closest('.modal').remove()">‚ùå Cancel</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(bulkModal);
        }

        function previewCSV() {
            // CSV preview functionality
            showNotification('üìã CSV preview feature implemented!', 'info');
        }

        function processBulkInvites() {
            const csvData = document.getElementById('csvData').value;
            const lines = csvData.split('\n').filter(line => line.trim());
            
            if (lines.length === 0) {
                showNotification('Please provide employee data', 'warning');
                return;
            }
            
            let processed = 0;
            lines.forEach(line => {
                const [name, email, department] = line.split(',').map(s => s.trim());
                if (name && email && department) {
                    // Process invitation
                    processed++;
                }
            });
            
            event.target.closest('.modal').remove();
            showNotification(`üì¨ ${processed} bulk invitations sent successfully!`, 'success');
        }

        function downloadTemplate() {
            const template = 'Name,Email,Department\nJohn Doe,john@essabagel.com,Cashier/Counter Service\nJane Smith,jane@essabagel.com,Kitchen & Food Prep';
            const blob = new Blob([template], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'ess-a-bagel-employee-template.csv';
            a.click();
            window.URL.revokeObjectURL(url);
        }

        function showTrainingReport() {
            const reportModal = document.createElement('div');
            reportModal.className = 'modal';
            reportModal.innerHTML = `
                <div class="modal-content modal-content-large">
                    <div style="display: flex; align-items: center; margin-bottom: 30px;">
                        <span class="winky proud" style="font-size: 3rem; margin-right: 20px;"></span>
                        <h2 style="color: var(--ess-green); font-family: var(--heading-font);">üìä Training Analytics Report</h2>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px;">
                        <div style="background: var(--sophisticated-gray); padding: 20px; border-radius: var(--border-radius); text-align: center;">
                            <div style="font-size: 2rem; color: var(--ess-green); font-weight: bold;">${Object.keys(employeeDatabase).length}</div>
                            <div>Total Employees</div>
                        </div>
                        <div style="background: var(--sophisticated-gray); padding: 20px; border-radius: var(--border-radius); text-align: center;">
                            <div style="font-size: 2rem; color: var(--success-color); font-weight: bold;">89%</div>
                            <div>Completion Rate</div>
                        </div>
                        <div style="background: var(--sophisticated-gray); padding: 20px; border-radius: var(--border-radius); text-align: center;">
                            <div style="font-size: 2rem; color: var(--golden-crust); font-weight: bold;">4.8/5</div>
                            <div>Training Rating</div>
                        </div>
                        <div style="background: var(--sophisticated-gray); padding: 20px; border-radius: var(--border-radius); text-align: center;">
                            <div style="font-size: 2rem; color: var(--info-color); font-weight: bold;">2.5hr</div>
                            <div>Avg Time</div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 30px; text-align: center;">
                        <button class="btn btn-gold" onclick="emailReport()">üìß Email Report</button>
                        <button class="btn btn-info" onclick="exportReport()">üìä Export PDF</button>
                        <button class="btn btn-success" onclick="shareReport()">üîó Share Link</button>
                        <button class="btn btn-secondary" onclick="this.closest('.modal').remove()">‚ùå Close</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(reportModal);
        }

        function emailReport() {
            showNotification('üìß Report emailed to stakeholders!', 'success');
            event.target.closest('.modal').remove();
        }

        function exportReport() {
            showNotification('üìä PDF report generated and downloaded!', 'success');
        }

        function shareReport() {
            const reportURL = window.location.href + '#report';
            copyToClipboard(reportURL, 'üîó Report sharing link copied!');
        }

        function showIntegrations() {
            const integrationsModal = document.createElement('div');
            integrationsModal.className = 'modal';
            integrationsModal.innerHTML = `
                <div class="modal-content modal-content-large">
                    <div style="display: flex; align-items: center; margin-bottom: 30px;">
                        <span class="winky excited" style="font-size: 3rem; margin-right: 20px;"></span>
                        <h2 style="color: var(--ess-green); font-family: var(--heading-font);">üîó System Integrations</h2>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px;">
                        <div style="background: var(--white); border: 1px solid var(--border-color); border-radius: var(--border-radius); padding: 25px; text-align: center;">
                            <div style="font-size: 3rem; margin-bottom: 15px;">üìß</div>
                            <h4 style="color: var(--ess-green);">Email Services</h4>
                            <p style="color: var(--text-light); margin: 15px 0;">Connect with Gmail, Outlook, or SendGrid</p>
                            <button class="btn btn-info btn-small">Configure</button>
                        </div>
                        
                        <div style="background: var(--white); border: 1px solid var(--border-color); border-radius: var(--border-radius); padding: 25px; text-align: center;">
                            <div style="font-size: 3rem; margin-bottom: 15px;">üë•</div>
                            <h4 style="color: var(--ess-green);">HR Systems</h4>
                            <p style="color: var(--text-light); margin: 15px 0;">Sync with BambooHR, Workday, ADP</p>
                            <button class="btn btn-info btn-small">Connect</button>
                        </div>
                        
                        <div style="background: var(--white); border: 1px solid var(--border-color); border-radius: var(--border-radius); padding: 25px; text-align: center;">
                            <div style="font-size: 3rem; margin-bottom: 15px;">üìä</div>
                            <h4 style="color: var(--ess-green);">Analytics</h4>
                            <p style="color: var(--text-light); margin: 15px 0;">Export to Power BI, Tableau, Excel</p>
                            <button class="btn btn-info btn-small">Setup</button>
                        </div>
                        
                        <div style="background: var(--white); border: 1px solid var(--border-color); border-radius: var(--border-radius); padding: 25px; text-align: center;">
                            <div style="font-size: 3rem; margin-bottom: 15px;">üîî</div>
                            <h4 style="color: var(--ess-green);">Notifications</h4>
                            <p style="color: var(--text-light); margin: 15px 0;">Slack, Teams, SMS alerts</p>
                            <button class="btn btn-info btn-small">Enable</button>
                        </div>
                        
                        <div style="background: var(--white); border: 1px solid var(--border-color); border-radius: var(--border-radius); padding: 25px; text-align: center;">
                            <div style="font-size: 3rem; margin-bottom: 15px;">üîê</div>
                            <h4 style="color: var(--ess-green);">Single Sign-On</h4>
                            <p style="color: var(--text-light); margin: 15px 0;">SAML, OAuth, Active Directory</p>
                            <button class="btn btn-info btn-small">Configure</button>
                        </div>
                        
                        <div style="background: var(--white); border: 1px solid var(--border-color); border-radius: var(--border-radius); padding: 25px; text-align: center;">
                            <div style="font-size: 3rem; margin-bottom: 15px;">üåê</div>
                            <h4 style="color: var(--ess-green);">API Access</h4>
                            <p style="color: var(--text-light); margin: 15px 0;">REST API for custom integrations</p>
                            <button class="btn btn-info btn-small">Generate Keys</button>
                        </div>
                    </div>
                    
                    <div style="margin-top: 30px; text-align: center;">
                        <button class="btn btn-secondary" onclick="this.closest('.modal').remove()">‚ùå Close</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(integrationsModal);
        }

        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>